/*
 * Custom scripts library
 *
 * @version 1.0.6
 */

function checkMobileNavgation(nav) {
	var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
	if (!nav.hasClass('burger'))
		if ( width < 768 ) nav.addClass('mobile')
		else nav.removeClass('mobile')
}

document.addEventListener('readystatechange', function(el) {
	if ( document.readyState === 'interactive' ) {
		// Adding class after full DOM loading for applying CSS animation
		//$('#main-header').addClass('visible');
		$.when( $('#dom-preloader').find('i').removeClass('fa-spin').end().delay(500).fadeOut('slow') )
		.done( function() { 
			$('body').fadeIn();
			$('#dom-preloader').remove(); 
		});		
	}
});

document.addEventListener("DOMContentLoaded", function() {

	var navigation = $('#header-nav');
	checkMobileNavgation(navigation);
	navigation.css('opacity', 1);
	var burger = $('#nav-burger');
	var mainheader = $('#main-header');
	var scrollup = $('#scroll-up');
	var search = $('#site-search-modal');
	var back2top = $('#back-to-top');
/*
// inView.js
	inView('.someSelector')
		.on('enter', el => {
			el.style.opacity =1;
			el.classList.add('visible');
		})
		.on('exit', el => {
			el.style.opacity = 0.5;
		});	
*/

	$( window ).on( 'resize', function( e ) {
		checkMobileNavgation(navigation);
		if (burger.hasClass('active')) burger.click(); // if burger menu open then close it 
	});

	$(window).scroll(function() {
		addVisibleClass(document.body.querySelectorAll('article')); //viewport.js
		addVisibleClass(document.body.querySelectorAll('#copyright'));

		$('#back-to-top').topBtnToggle({
			scrollTrigger: 1200,
			//debug: true,
		});

		if ( $('body').has('.parallax').length ) {
			// init parallax for background
			$('.parallax').bgParallax({
				bgpositionY: 50, //it must be the same background-position value in css 
				speed: 0.5,
			});
		}
	});

/*
// Click event on link starting from # for landing page
	$('a[href^="#"]').on('click', function (e) {
		e.preventDefault();
		var target = $(this).attr('href');
		if ( target.length > 1 && window.location.pathname == '/' && window.location.search == '') { //if home page and no search query and no only #
			//if ($(target).hasClass('animate')) $(target).removeClass('animate');
			if (burger.is(':visible')) burger.click(); //close burger menu on link clicking

			var top = $(target).offset().top;
			$('html, body').animate({scrollTop: top}, 500+top/4); //800 - длительность скроллинга в мс			
		} else {
			//target = target.replace(/[^A-Za-z]/g, "");
			location.replace('/'+target);
		}
	});

*/	burger.on('click', function (e) {
		if (burger.is(':visible')) {
			burger.toggleClass('active');
			$('#menu-top').toggleClass('active');
			$(document.body).toggleClass('modal');
		}
	});

	var submenu_item = $('.menu-item-has-children a').on('click', function (e) {
		e.preventDefault();
		$(this).parent().toggleClass('collapsed');
	});
		
	$( document ).on( 'keyup', function (e) {
		e.preventDefault();
		if( e.keyCode == 27 && search.is(':visible') )
			search.fadeToggle(300) //close search form
		else
		if( e.keyCode == 27 && burger.hasClass('active') ) burger.click(); // close burger menu on esc key
	});
	
	scrollup.on('click', function (e) {
		var mc = document.body.querySelector('#main-container');
		scrollup
		.fadeOut('slow')
		.delay(500)
		.remove()
		.delay(500)
		.queue( function() {
			mc.scrollIntoView({block: "start", behavior: "smooth"});
		});
	});

	back2top.on('click', function (e) {		
		// 800 - скорость задержки перемещения наверх (в миллисекундах)
		e.preventDefault();
		$('html,body').animate({scrollTop: 0}, 800);		
	});

	$('#nav-search').on('click', function (e) {
		if ( !search.attr('display','none') && search.find('#s').val() ) {
			$('#searchform').submit(); 
		} else search.fadeToggle(300);
	});

	$('#searchform').on('submit', function (e) {
		//идет поиск...
		//можно вывести preloader с надписью
	});

	$('#searchform-close').on('click', function (e) {
		var field_s = search.find('#s');
		if ( field_s.val() ) field_s.val('')
		else search.fadeToggle(300);
	});

	if ( $('.jcarousel').length > 0 ) {
		var j = $(".jcarousel-wrapper li");
		if (j.length > 0) j.css("width", j.parents(".jcarousel-wrapper").css("width"));
	}
	
	if ( $('.jcarousel').has('.header-background').length ) {

		$('[data-jcarousel]').each(function() {
			var el = $(this);
			el.jcarousel(el.data());
		});

		$('.jcarousel')		
			.on('jcarousel:reloadend', function(event, carousel) {
				$(this).jcarousel('target').addClass('active');

			})
			.on('jcarousel:visibleout', 'li', function() {
				$(this).removeClass('active');
			})
			.on('jcarousel:visiblein', 'li', function() {
				$(this).addClass('active');
			})
			.jcarousel({
				wrap: 'circular',
				animation: 1000,
				transitions: Modernizr.csstransitions ? {
					transforms:   Modernizr.csstransforms,
					transforms3d: Modernizr.csstransforms3d,
					easing:       'ease'
				} : false
			})
			.jcarouselSwipe();

			if ( 'true' === $('.jcarousel').attr('data-jcarouselautoscroll') ) {
				$('.jcarousel').jcarouselAutoscroll({
					interval:  5000,
					//autostart: false,
					//target: '-=1',
				});
			}

			if ( $('.jcarousel-wrapper').has('.jcarousel-control').length ) {
			
			$('.jcarousel-control.prev')
				.on('jcarouselcontrol:active', function() {
					$(this).removeClass('inactive');
				})
				.on('jcarouselcontrol:inactive', function() {
					$(this).addClass('inactive');
				})
				.jcarouselControl({
					target: '-=1'
				});

			$('.jcarousel-control.next')
				.on('jcarouselcontrol:active', function() {
					$(this).removeClass('inactive');
				})
				.on('jcarouselcontrol:inactive', function() {
					$(this).addClass('inactive');
				})
				.jcarouselControl({
					target: '+=1'
				});

			$(".jcarousel-wrapper").hover( function() {
				$('.jcarousel-control').fadeIn(700);
			}, function() {
				$('.jcarousel-control').fadeOut(700);
			});

		}

		if ( $('.jcarousel-wrapper').has('.jcarousel-pagination').length && 'true' === $('.jcarousel-pagination').attr('data-jcarouselpagination') ) {
			$('.jcarousel-pagination')
				.on('jcarouselpagination:active', 'a', function() {
					$(this).addClass('active');
				})
				.on('jcarouselpagination:inactive', 'a', function() {
					$(this).removeClass('active');
				})
				.jcarouselPagination();
		} else $('.jcarousel-pagination').remove();
	}

	//Adding an agent to HTML selector
	var deviceAgent = navigator.userAgent.toLowerCase();
	if (deviceAgent.match(/(iphone|ipod|ipad)/)) {
		$("html").addClass("ios");
		$("html").addClass("mobile");
	}
	if (navigator.userAgent.search("MSIE") >= 0) {
		$("html").addClass("ie");
	}
	else if (navigator.userAgent.search("Chrome") >= 0) {
		$("html").addClass("chrome");
	}
	else if (navigator.userAgent.search("Firefox") >= 0) {
		$("html").addClass("firefox");
	}
	else if (navigator.userAgent.search("Safari") >= 0 && navigator.userAgent.search("Chrome") < 0) {
		$("html").addClass("safari");
	}
	else if (navigator.userAgent.search("Opera") >= 0) {
		$("html").addClass("opera");
	}

});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN1c3RvbS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJjdXN0b20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQ3VzdG9tIHNjcmlwdHMgbGlicmFyeVxyXG4gKlxyXG4gKiBAdmVyc2lvbiAxLjAuNlxyXG4gKi9cclxuXHJcbmZ1bmN0aW9uIGNoZWNrTW9iaWxlTmF2Z2F0aW9uKG5hdikge1xyXG5cdHZhciB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoO1xyXG5cdGlmICghbmF2Lmhhc0NsYXNzKCdidXJnZXInKSlcclxuXHRcdGlmICggd2lkdGggPCA3NjggKSBuYXYuYWRkQ2xhc3MoJ21vYmlsZScpXHJcblx0XHRlbHNlIG5hdi5yZW1vdmVDbGFzcygnbW9iaWxlJylcclxufVxyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsIGZ1bmN0aW9uKGVsKSB7XHJcblx0aWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnaW50ZXJhY3RpdmUnICkge1xyXG5cdFx0Ly8gQWRkaW5nIGNsYXNzIGFmdGVyIGZ1bGwgRE9NIGxvYWRpbmcgZm9yIGFwcGx5aW5nIENTUyBhbmltYXRpb25cclxuXHRcdC8vJCgnI21haW4taGVhZGVyJykuYWRkQ2xhc3MoJ3Zpc2libGUnKTtcclxuXHRcdCQud2hlbiggJCgnI2RvbS1wcmVsb2FkZXInKS5maW5kKCdpJykucmVtb3ZlQ2xhc3MoJ2ZhLXNwaW4nKS5lbmQoKS5kZWxheSg1MDApLmZhZGVPdXQoJ3Nsb3cnKSApXHJcblx0XHQuZG9uZSggZnVuY3Rpb24oKSB7IFxyXG5cdFx0XHQkKCdib2R5JykuZmFkZUluKCk7XHJcblx0XHRcdCQoJyNkb20tcHJlbG9hZGVyJykucmVtb3ZlKCk7IFxyXG5cdFx0fSk7XHRcdFxyXG5cdH1cclxufSk7XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbigpIHtcclxuXHJcblx0dmFyIG5hdmlnYXRpb24gPSAkKCcjaGVhZGVyLW5hdicpO1xyXG5cdGNoZWNrTW9iaWxlTmF2Z2F0aW9uKG5hdmlnYXRpb24pO1xyXG5cdG5hdmlnYXRpb24uY3NzKCdvcGFjaXR5JywgMSk7XHJcblx0dmFyIGJ1cmdlciA9ICQoJyNuYXYtYnVyZ2VyJyk7XHJcblx0dmFyIG1haW5oZWFkZXIgPSAkKCcjbWFpbi1oZWFkZXInKTtcclxuXHR2YXIgc2Nyb2xsdXAgPSAkKCcjc2Nyb2xsLXVwJyk7XHJcblx0dmFyIHNlYXJjaCA9ICQoJyNzaXRlLXNlYXJjaC1tb2RhbCcpO1xyXG5cdHZhciBiYWNrMnRvcCA9ICQoJyNiYWNrLXRvLXRvcCcpO1xyXG4vKlxyXG4vLyBpblZpZXcuanNcclxuXHRpblZpZXcoJy5zb21lU2VsZWN0b3InKVxyXG5cdFx0Lm9uKCdlbnRlcicsIGVsID0+IHtcclxuXHRcdFx0ZWwuc3R5bGUub3BhY2l0eSA9MTtcclxuXHRcdFx0ZWwuY2xhc3NMaXN0LmFkZCgndmlzaWJsZScpO1xyXG5cdFx0fSlcclxuXHRcdC5vbignZXhpdCcsIGVsID0+IHtcclxuXHRcdFx0ZWwuc3R5bGUub3BhY2l0eSA9IDAuNTtcclxuXHRcdH0pO1x0XHJcbiovXHJcblxyXG5cdCQoIHdpbmRvdyApLm9uKCAncmVzaXplJywgZnVuY3Rpb24oIGUgKSB7XHJcblx0XHRjaGVja01vYmlsZU5hdmdhdGlvbihuYXZpZ2F0aW9uKTtcclxuXHRcdGlmIChidXJnZXIuaGFzQ2xhc3MoJ2FjdGl2ZScpKSBidXJnZXIuY2xpY2soKTsgLy8gaWYgYnVyZ2VyIG1lbnUgb3BlbiB0aGVuIGNsb3NlIGl0IFxyXG5cdH0pO1xyXG5cclxuXHQkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCkge1xyXG5cdFx0YWRkVmlzaWJsZUNsYXNzKGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvckFsbCgnYXJ0aWNsZScpKTsgLy92aWV3cG9ydC5qc1xyXG5cdFx0YWRkVmlzaWJsZUNsYXNzKGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvckFsbCgnI2NvcHlyaWdodCcpKTtcclxuXHJcblx0XHQkKCcjYmFjay10by10b3AnKS50b3BCdG5Ub2dnbGUoe1xyXG5cdFx0XHRzY3JvbGxUcmlnZ2VyOiAxMjAwLFxyXG5cdFx0XHQvL2RlYnVnOiB0cnVlLFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0aWYgKCAkKCdib2R5JykuaGFzKCcucGFyYWxsYXgnKS5sZW5ndGggKSB7XHJcblx0XHRcdC8vIGluaXQgcGFyYWxsYXggZm9yIGJhY2tncm91bmRcclxuXHRcdFx0JCgnLnBhcmFsbGF4JykuYmdQYXJhbGxheCh7XHJcblx0XHRcdFx0Ymdwb3NpdGlvblk6IDUwLCAvL2l0IG11c3QgYmUgdGhlIHNhbWUgYmFja2dyb3VuZC1wb3NpdGlvbiB2YWx1ZSBpbiBjc3MgXHJcblx0XHRcdFx0c3BlZWQ6IDAuNSxcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG4vKlxyXG4vLyBDbGljayBldmVudCBvbiBsaW5rIHN0YXJ0aW5nIGZyb20gIyBmb3IgbGFuZGluZyBwYWdlXHJcblx0JCgnYVtocmVmXj1cIiNcIl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0dmFyIHRhcmdldCA9ICQodGhpcykuYXR0cignaHJlZicpO1xyXG5cdFx0aWYgKCB0YXJnZXQubGVuZ3RoID4gMSAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT0gJy8nICYmIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggPT0gJycpIHsgLy9pZiBob21lIHBhZ2UgYW5kIG5vIHNlYXJjaCBxdWVyeSBhbmQgbm8gb25seSAjXHJcblx0XHRcdC8vaWYgKCQodGFyZ2V0KS5oYXNDbGFzcygnYW5pbWF0ZScpKSAkKHRhcmdldCkucmVtb3ZlQ2xhc3MoJ2FuaW1hdGUnKTtcclxuXHRcdFx0aWYgKGJ1cmdlci5pcygnOnZpc2libGUnKSkgYnVyZ2VyLmNsaWNrKCk7IC8vY2xvc2UgYnVyZ2VyIG1lbnUgb24gbGluayBjbGlja2luZ1xyXG5cclxuXHRcdFx0dmFyIHRvcCA9ICQodGFyZ2V0KS5vZmZzZXQoKS50b3A7XHJcblx0XHRcdCQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6IHRvcH0sIDUwMCt0b3AvNCk7IC8vODAwIC0g0LTQu9C40YLQtdC70YzQvdC+0YHRgtGMINGB0LrRgNC+0LvQu9C40L3Qs9CwINCyINC80YFcdFx0XHRcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdC8vdGFyZ2V0ID0gdGFyZ2V0LnJlcGxhY2UoL1teQS1aYS16XS9nLCBcIlwiKTtcclxuXHRcdFx0bG9jYXRpb24ucmVwbGFjZSgnLycrdGFyZ2V0KTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcbiovXHRidXJnZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdGlmIChidXJnZXIuaXMoJzp2aXNpYmxlJykpIHtcclxuXHRcdFx0YnVyZ2VyLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcclxuXHRcdFx0JCgnI21lbnUtdG9wJykudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHQkKGRvY3VtZW50LmJvZHkpLnRvZ2dsZUNsYXNzKCdtb2RhbCcpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHR2YXIgc3VibWVudV9pdGVtID0gJCgnLm1lbnUtaXRlbS1oYXMtY2hpbGRyZW4gYScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHQkKHRoaXMpLnBhcmVudCgpLnRvZ2dsZUNsYXNzKCdjb2xsYXBzZWQnKTtcclxuXHR9KTtcclxuXHRcdFxyXG5cdCQoIGRvY3VtZW50ICkub24oICdrZXl1cCcsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRpZiggZS5rZXlDb2RlID09IDI3ICYmIHNlYXJjaC5pcygnOnZpc2libGUnKSApXHJcblx0XHRcdHNlYXJjaC5mYWRlVG9nZ2xlKDMwMCkgLy9jbG9zZSBzZWFyY2ggZm9ybVxyXG5cdFx0ZWxzZVxyXG5cdFx0aWYoIGUua2V5Q29kZSA9PSAyNyAmJiBidXJnZXIuaGFzQ2xhc3MoJ2FjdGl2ZScpICkgYnVyZ2VyLmNsaWNrKCk7IC8vIGNsb3NlIGJ1cmdlciBtZW51IG9uIGVzYyBrZXlcclxuXHR9KTtcclxuXHRcclxuXHRzY3JvbGx1cC5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0dmFyIG1jID0gZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCcjbWFpbi1jb250YWluZXInKTtcclxuXHRcdHNjcm9sbHVwXHJcblx0XHQuZmFkZU91dCgnc2xvdycpXHJcblx0XHQuZGVsYXkoNTAwKVxyXG5cdFx0LnJlbW92ZSgpXHJcblx0XHQuZGVsYXkoNTAwKVxyXG5cdFx0LnF1ZXVlKCBmdW5jdGlvbigpIHtcclxuXHRcdFx0bWMuc2Nyb2xsSW50b1ZpZXcoe2Jsb2NrOiBcInN0YXJ0XCIsIGJlaGF2aW9yOiBcInNtb290aFwifSk7XHJcblx0XHR9KTtcclxuXHR9KTtcclxuXHJcblx0YmFjazJ0b3Aub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcdFx0XHJcblx0XHQvLyA4MDAgLSDRgdC60L7RgNC+0YHRgtGMINC30LDQtNC10YDQttC60Lgg0L/QtdGA0LXQvNC10YnQtdC90LjRjyDQvdCw0LLQtdGA0YUgKNCyINC80LjQu9C70LjRgdC10LrRg9C90LTQsNGFKVxyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0JCgnaHRtbCxib2R5JykuYW5pbWF0ZSh7c2Nyb2xsVG9wOiAwfSwgODAwKTtcdFx0XHJcblx0fSk7XHJcblxyXG5cdCQoJyNuYXYtc2VhcmNoJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdGlmICggIXNlYXJjaC5hdHRyKCdkaXNwbGF5Jywnbm9uZScpICYmIHNlYXJjaC5maW5kKCcjcycpLnZhbCgpICkge1xyXG5cdFx0XHQkKCcjc2VhcmNoZm9ybScpLnN1Ym1pdCgpOyBcclxuXHRcdH0gZWxzZSBzZWFyY2guZmFkZVRvZ2dsZSgzMDApO1xyXG5cdH0pO1xyXG5cclxuXHQkKCcjc2VhcmNoZm9ybScpLm9uKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0Ly/QuNC00LXRgiDQv9C+0LjRgdC6Li4uXHJcblx0XHQvL9C80L7QttC90L4g0LLRi9Cy0LXRgdGC0LggcHJlbG9hZGVyINGBINC90LDQtNC/0LjRgdGM0Y5cclxuXHR9KTtcclxuXHJcblx0JCgnI3NlYXJjaGZvcm0tY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0dmFyIGZpZWxkX3MgPSBzZWFyY2guZmluZCgnI3MnKTtcclxuXHRcdGlmICggZmllbGRfcy52YWwoKSApIGZpZWxkX3MudmFsKCcnKVxyXG5cdFx0ZWxzZSBzZWFyY2guZmFkZVRvZ2dsZSgzMDApO1xyXG5cdH0pO1xyXG5cclxuXHRpZiAoICQoJy5qY2Fyb3VzZWwnKS5sZW5ndGggPiAwICkge1xyXG5cdFx0dmFyIGogPSAkKFwiLmpjYXJvdXNlbC13cmFwcGVyIGxpXCIpO1xyXG5cdFx0aWYgKGoubGVuZ3RoID4gMCkgai5jc3MoXCJ3aWR0aFwiLCBqLnBhcmVudHMoXCIuamNhcm91c2VsLXdyYXBwZXJcIikuY3NzKFwid2lkdGhcIikpO1xyXG5cdH1cclxuXHRcclxuXHRpZiAoICQoJy5qY2Fyb3VzZWwnKS5oYXMoJy5oZWFkZXItYmFja2dyb3VuZCcpLmxlbmd0aCApIHtcclxuXHJcblx0XHQkKCdbZGF0YS1qY2Fyb3VzZWxdJykuZWFjaChmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIGVsID0gJCh0aGlzKTtcclxuXHRcdFx0ZWwuamNhcm91c2VsKGVsLmRhdGEoKSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHQkKCcuamNhcm91c2VsJylcdFx0XHJcblx0XHRcdC5vbignamNhcm91c2VsOnJlbG9hZGVuZCcsIGZ1bmN0aW9uKGV2ZW50LCBjYXJvdXNlbCkge1xyXG5cdFx0XHRcdCQodGhpcykuamNhcm91c2VsKCd0YXJnZXQnKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcblxyXG5cdFx0XHR9KVxyXG5cdFx0XHQub24oJ2pjYXJvdXNlbDp2aXNpYmxlb3V0JywgJ2xpJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdH0pXHJcblx0XHRcdC5vbignamNhcm91c2VsOnZpc2libGVpbicsICdsaScsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdCQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHR9KVxyXG5cdFx0XHQuamNhcm91c2VsKHtcclxuXHRcdFx0XHR3cmFwOiAnY2lyY3VsYXInLFxyXG5cdFx0XHRcdGFuaW1hdGlvbjogMTAwMCxcclxuXHRcdFx0XHR0cmFuc2l0aW9uczogTW9kZXJuaXpyLmNzc3RyYW5zaXRpb25zID8ge1xyXG5cdFx0XHRcdFx0dHJhbnNmb3JtczogICBNb2Rlcm5penIuY3NzdHJhbnNmb3JtcyxcclxuXHRcdFx0XHRcdHRyYW5zZm9ybXMzZDogTW9kZXJuaXpyLmNzc3RyYW5zZm9ybXMzZCxcclxuXHRcdFx0XHRcdGVhc2luZzogICAgICAgJ2Vhc2UnXHJcblx0XHRcdFx0fSA6IGZhbHNlXHJcblx0XHRcdH0pXHJcblx0XHRcdC5qY2Fyb3VzZWxTd2lwZSgpO1xyXG5cclxuXHRcdFx0aWYgKCAndHJ1ZScgPT09ICQoJy5qY2Fyb3VzZWwnKS5hdHRyKCdkYXRhLWpjYXJvdXNlbGF1dG9zY3JvbGwnKSApIHtcclxuXHRcdFx0XHQkKCcuamNhcm91c2VsJykuamNhcm91c2VsQXV0b3Njcm9sbCh7XHJcblx0XHRcdFx0XHRpbnRlcnZhbDogIDUwMDAsXHJcblx0XHRcdFx0XHQvL2F1dG9zdGFydDogZmFsc2UsXHJcblx0XHRcdFx0XHQvL3RhcmdldDogJy09MScsXHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICggJCgnLmpjYXJvdXNlbC13cmFwcGVyJykuaGFzKCcuamNhcm91c2VsLWNvbnRyb2wnKS5sZW5ndGggKSB7XHJcblx0XHRcdFxyXG5cdFx0XHQkKCcuamNhcm91c2VsLWNvbnRyb2wucHJldicpXHJcblx0XHRcdFx0Lm9uKCdqY2Fyb3VzZWxjb250cm9sOmFjdGl2ZScsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnaW5hY3RpdmUnKTtcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHRcdC5vbignamNhcm91c2VsY29udHJvbDppbmFjdGl2ZScsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0JCh0aGlzKS5hZGRDbGFzcygnaW5hY3RpdmUnKTtcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHRcdC5qY2Fyb3VzZWxDb250cm9sKHtcclxuXHRcdFx0XHRcdHRhcmdldDogJy09MSdcclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdCQoJy5qY2Fyb3VzZWwtY29udHJvbC5uZXh0JylcclxuXHRcdFx0XHQub24oJ2pjYXJvdXNlbGNvbnRyb2w6YWN0aXZlJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHQkKHRoaXMpLnJlbW92ZUNsYXNzKCdpbmFjdGl2ZScpO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0Lm9uKCdqY2Fyb3VzZWxjb250cm9sOmluYWN0aXZlJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHQkKHRoaXMpLmFkZENsYXNzKCdpbmFjdGl2ZScpO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0LmpjYXJvdXNlbENvbnRyb2woe1xyXG5cdFx0XHRcdFx0dGFyZ2V0OiAnKz0xJ1xyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0JChcIi5qY2Fyb3VzZWwtd3JhcHBlclwiKS5ob3ZlciggZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0JCgnLmpjYXJvdXNlbC1jb250cm9sJykuZmFkZUluKDcwMCk7XHJcblx0XHRcdH0sIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdCQoJy5qY2Fyb3VzZWwtY29udHJvbCcpLmZhZGVPdXQoNzAwKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdGlmICggJCgnLmpjYXJvdXNlbC13cmFwcGVyJykuaGFzKCcuamNhcm91c2VsLXBhZ2luYXRpb24nKS5sZW5ndGggJiYgJ3RydWUnID09PSAkKCcuamNhcm91c2VsLXBhZ2luYXRpb24nKS5hdHRyKCdkYXRhLWpjYXJvdXNlbHBhZ2luYXRpb24nKSApIHtcclxuXHRcdFx0JCgnLmpjYXJvdXNlbC1wYWdpbmF0aW9uJylcclxuXHRcdFx0XHQub24oJ2pjYXJvdXNlbHBhZ2luYXRpb246YWN0aXZlJywgJ2EnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdCQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0Lm9uKCdqY2Fyb3VzZWxwYWdpbmF0aW9uOmluYWN0aXZlJywgJ2EnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdCQodGhpcykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0LmpjYXJvdXNlbFBhZ2luYXRpb24oKTtcclxuXHRcdH0gZWxzZSAkKCcuamNhcm91c2VsLXBhZ2luYXRpb24nKS5yZW1vdmUoKTtcclxuXHR9XHJcblxyXG5cdC8vQWRkaW5nIGFuIGFnZW50IHRvIEhUTUwgc2VsZWN0b3JcclxuXHR2YXIgZGV2aWNlQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7XHJcblx0aWYgKGRldmljZUFnZW50Lm1hdGNoKC8oaXBob25lfGlwb2R8aXBhZCkvKSkge1xyXG5cdFx0JChcImh0bWxcIikuYWRkQ2xhc3MoXCJpb3NcIik7XHJcblx0XHQkKFwiaHRtbFwiKS5hZGRDbGFzcyhcIm1vYmlsZVwiKTtcclxuXHR9XHJcblx0aWYgKG5hdmlnYXRvci51c2VyQWdlbnQuc2VhcmNoKFwiTVNJRVwiKSA+PSAwKSB7XHJcblx0XHQkKFwiaHRtbFwiKS5hZGRDbGFzcyhcImllXCIpO1xyXG5cdH1cclxuXHRlbHNlIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LnNlYXJjaChcIkNocm9tZVwiKSA+PSAwKSB7XHJcblx0XHQkKFwiaHRtbFwiKS5hZGRDbGFzcyhcImNocm9tZVwiKTtcclxuXHR9XHJcblx0ZWxzZSBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5zZWFyY2goXCJGaXJlZm94XCIpID49IDApIHtcclxuXHRcdCQoXCJodG1sXCIpLmFkZENsYXNzKFwiZmlyZWZveFwiKTtcclxuXHR9XHJcblx0ZWxzZSBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5zZWFyY2goXCJTYWZhcmlcIikgPj0gMCAmJiBuYXZpZ2F0b3IudXNlckFnZW50LnNlYXJjaChcIkNocm9tZVwiKSA8IDApIHtcclxuXHRcdCQoXCJodG1sXCIpLmFkZENsYXNzKFwic2FmYXJpXCIpO1xyXG5cdH1cclxuXHRlbHNlIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LnNlYXJjaChcIk9wZXJhXCIpID49IDApIHtcclxuXHRcdCQoXCJodG1sXCIpLmFkZENsYXNzKFwib3BlcmFcIik7XHJcblx0fVxyXG5cclxufSk7XHJcbiJdfQ==
