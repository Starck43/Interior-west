/*
 * Custom scripts library
 *
 * @version 1.0.8
 */

var $ = jQuery.noConflict();
var width;

function checkMobileNavgation(nav) {
	width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
	//height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
	if (!nav.hasClass('burger'))
		if ( width < 768 ) nav.addClass('mobile')
		else nav.removeClass('mobile')
}

document.addEventListener('readystatechange', function(el) {
	if ( document.readyState === 'interactive' ) {}
});

document.addEventListener("DOMContentLoaded", function() {

	$('#dom-preloader').fadeOut(500, function() { $('#dom-preloader').remove(); });
	$('body').fadeIn(500);
	var overlay = $('#overlay');
	var navigation = $('#header-nav');
	checkMobileNavgation(navigation);
	navigation.css('opacity', 1);
	var burger = $('#nav-burger');
	var mobileMenu = $('ul.primary-menu');
	var mainheader = $('#main-header');
	if (mainheader) mainheader.addClass('visible');
	var scrollup = $('#scroll-up');
	var search = $('#site-search-modal');
	var back2top = $('#link-to-top');
	var gotoBack = $('#link-to-back:not(.show-in-top)');

	var stopScroll;
	var scrollPos_Y;

	function disableScroll() {
		scrollPos_Y = $(window).scrollTop();
		stopScroll = true;
		$('body').addClass('scroll-disabled').css('margin-top', -scrollPos_Y + 'px');

		//$('#overlay .image-box').on("touchmove", function(e) { e.stopPropagation(); });
	}

	function enableScroll() {
		stopScroll = false;
		$('body').removeClass('scroll-disabled').css('margin-top', 0);
		$(window).scrollTop(scrollPos_Y);

		//$('#overlay .image-box').unbind("touchmove");
	}

	function disableTouchMove() {
		document.ontouchmove = function(e) { e.preventDefault(); }
		return true;
	}

	function enableTouchMove() {
		document.ontouchmove = function() { return true; }
		return false;
	}	

	// in vewport check script
	inView.offset(200);
	inView('#overview-page article')
		.on('enter', el => {
			//el.style.opacity = 1;
			el.classList.add('lazyloaded');
		})
		.on('exit', el => {
			//el.style.opacity = 0.5;
		});
	inView('article.page')
		.on('enter', el => {
			el.classList.add('in-view');
		})

	$( window ).on( 'resize', function( e ) {
		checkMobileNavgation(navigation);

		if (mobileMenu.hasClass('active')) burger.click(); // if burger menu open then close it
	});

	$(window).scroll(function() {
		//addVisibleClass(document.body.querySelectorAll('article')); //viewport.js

		back2top && back2top.topBtnToggle({
			scrollTrigger: 1000,
			//debug: true,
		});

		gotoBack && gotoBack.topBtnToggle({
			scrollTrigger: 1000,
			//debug: true,
		});

		if ( $('body').has('.parallax').length ) {
			// init parallax for background
			$('.parallax').bgParallax({
				bgpositionY: 50, //it must be the same background-position value in css
				speed: 0.5,
			});
		}
	});


/*
// Click event on link starting from # for landing page
	$('a[href^="#"]').on('click', function (e) {
		e.preventDefault();
		var target = $(this).attr('href');
		if ( target.length > 1 && window.location.pathname == '/' && window.location.search == '') { //if home page and no search query and no only #
			//if ($(target).hasClass('animate')) $(target).removeClass('animate');
			if (burger.is(':visible')) burger.click(); //close burger menu on link clicking

			var top = $(target).offset().top;
			$('html, body').animate({scrollTop: top}, 500+top/4); //800 - длительность скроллинга в мс			
		} else {
			//target = target.replace(/[^A-Za-z]/g, "");
			location.replace('/'+target);
		}
	});

*/
/*
	burger.on('click', function (e) {
		if (burger.is(':visible')) {
			burger.toggleClass('active');
			$('#menu-top').toggleClass('active');
			$(document.body).toggleClass('modal');
		}
	});
*/
	//New version with own close button in menu
	burger.on('click', function (e) {
		if (!mobileMenu.hasClass('active')) {
			mobileMenu.prepend('<div class="close-icon"></div>');
			//burger.toggleClass('active');
			mobileMenu.addClass('active');
			//$(document.body).toggleClass('modal');
		}
	});

	mobileMenu.on('click','.close-icon', function (e) {
		mobileMenu.removeClass('active').children().remove('.close-icon');
	});
	
	var submenu_item = $('.menu-item-has-children a').on('click', function (e) {
		e.preventDefault();
		$(this).parent().toggleClass('collapsed');
	});
		
	$( document ).on( 'keyup', function (e) {
		e.preventDefault();
		if( e.keyCode == 27 && !search.hasClass('hidden') )
			//close search form
			search.addClass('hidden') //if( e.keyCode == 27 && search.is(':visible') ) search.fadeToggle(300)
		else
		if( e.keyCode == 27 && !overlay.hasClass('hidden') )
			overlay.click() //close overlay form
		else //close burger menu on esc key
		if( e.keyCode == 27 && mobileMenu.hasClass('active') ) mobileMenu.children('.close-icon').click(); // if( e.keyCode == 27 && burger.hasClass('active') ) burger.click();
	});


	scrollup.on('click', function (e) {
		var mc = document.body.querySelector('#main-container');
		scrollup
		.fadeOut('slow')
		.delay(500)
		.remove()
		.delay(500)
		.queue( function() {
			mc.scrollIntoView({block: "start", behavior: "smooth"});
		});
	});

	back2top.on('click', function (e) {
		// 800 - скорость задержки перемещения наверх (в миллисекундах)
		e.preventDefault();
		$('html,body').animate({scrollTop: 0}, 800);
	});

	$('#nav-search').on('click', function (e) {
		if ( !search.attr('display','none') && search.find('#s').val() ) {
			$('#searchform').submit(); 
		} else search.fadeToggle(300);
	});
/*
	$('#nav-search').on('click', function (e) {
		search.toggleClass('hidden');
	});

	$('#searchform').on('submit', function (e) {
		//идет поиск...
		//можно вывести preloader с надписью
	});
	$('#searchform-close').on('click', function (e) {
		var field_s = search.find('#s');
		if ( field_s.val() ) field_s.val('')
		else search.fadeToggle(300);
	});
*/
	search.on('click','.close-icon', function (e) {
		search.addClass('hidden');
	});

	overlay.on('click', function (e) {
		$(this).addClass('hidden');
		enableScroll();
	});

	if ( $('.jcarousel').has('li.slide').length ) {

		$('[data-jcarousel]').each(function() {
			var el = $(this);
			el.jcarousel(el.data());
		});

		var xStart, yStart;
		var stopTouch;
		var slidesPerPage = 1;

		var carousel = $('.jcarousel');
		carousel
			.on('jcarousel:create jcarousel:reload', function() {
				var carousel_w = carousel.parent().innerWidth(),
					carousel_h = carousel.parent().innerHeight();

				slidesPerPage = (carousel_w > carousel_h) ? Math.trunc(  carousel_w / carousel_h ) : 1;

				var slide_width = Math.ceil( carousel_w / slidesPerPage );
				carousel.jcarousel('items').css("width", slide_width + 'px');
			})
			.on('touchstart', function(e) {
				xStart = e.touches[0].screenX;
				yStart = e.touches[0].screenY;
				stopTouch = null;
			})
			.on('touchmove', function(e) {
				var xMovement = Math.abs(e.touches[0].screenX - xStart);
				var yMovement = Math.abs(e.touches[0].screenY - yStart);
				if (stopTouch == null && (xMovement > 10 || yMovement > 10))
					stopTouch = (yMovement < xMovement) ? disableTouchMove() : enableTouchMove();
			})
			.on('touchend touchcancel', function() {
				stopTouch && enableTouchMove();
			})
			.on('jcarousel:createend jcarousel:animateend', function() {
				$(this).jcarousel('target').addClass('active');
			})
			.on('jcarousel:visibleout', 'li', function() {
				$(this).removeClass('active');
			})
			.on('click', 'li', function (e) {
				var src = $(this).attr('src-url');
				if (src) {
					src = 'url('+src+')';
					//var bg = $(e.target).css('background-image');
					//bg = bg.replace('url(','').replace(')','').replace(/\"/gi, "");
					!overlay.children('.imagebox').length && overlay.append('<div class="imagebox"></div><div class="close close-icon" title="Close"></div>');
					overlay.children('.imagebox').css('background-image', src).parent().removeClass('hidden');
					disableScroll();
				}
			})
			.jcarousel({
				//scroll: slidesPerPage,
				//center: true,
				wrap: 'circular',
				animation: 500,
				//transitions: true,
				transitions: Modernizr.csstransitions ? {
					transforms:   Modernizr.csstransforms,
					transforms3d: Modernizr.csstransforms3d,
					easing:       'ease'
				} : false
			})
			//.jcarousel('scroll', '+='+String(slidesPerPage))
			.jcarouselSwipe({
				//perSwipe: slidesPerPage
				//method: 'scrollIntoView' // by default 'scroll'
			});

			if ( 'true' === carousel.attr('data-jcarouselautoscroll') ) {
				carousel.jcarouselAutoscroll({
					interval:  5000,
					//autostart: false,
					//target: '-=1'+String(slidesPerPage)
				});
			}

			if ( $('.jcarousel-wrapper').has('.jcarousel-control').length ) {

				$('.jcarousel-control.prev')
					.on('jcarouselcontrol:active', function() {
						$(this).removeClass('inactive');
					})
					.on('jcarouselcontrol:inactive', function() {
						$(this).addClass('inactive');
					})
					.jcarouselControl({
						//target: '-='+String(slidesPerPage)
					});

				$('.jcarousel-control.next')
					.on('jcarouselcontrol:active', function() {
						$(this).removeClass('inactive');
					})
					.on('jcarouselcontrol:inactive', function() {
						$(this).addClass('inactive');
					})
					.jcarouselControl({
						//target: '+='+String(slidesPerPage)
					});
	/*
				if ( !$("html").has("mobile") ) {
					$(".jcarousel-wrapper").hover( function() {
						$('.jcarousel-control').fadeIn(300);
					}, function() {
						$('.jcarousel-control').fadeOut(300);
					});
				}
	*/

			}

		if ( $('.jcarousel-wrapper').has('.jcarousel-pagination').length && 'true' === $('.jcarousel-pagination').attr('data-jcarouselpagination') ) {
			$('.jcarousel-pagination')
				.on('jcarouselpagination:active', 'a', function() {
					$(this).addClass('active');
				})
				.on('jcarouselpagination:inactive', 'a', function() {
					$(this).removeClass('active');
				})
				.jcarouselPagination({
					//'perPage': slidesPerPage
				});
		} else $('.jcarousel-pagination').remove();

	}

	//Adding an agent to HTML selector
	var deviceAgent = navigator.userAgent.toLowerCase();
	if (deviceAgent.match(/(iphone|ipod|ipad)/)) {
		$("html").addClass("mobile");
		$("html").addClass("ios");
	}
	if (navigator.userAgent.search("MSIE") >= 0) {
		$("html").addClass("ie");
	}
	else if (navigator.userAgent.search("Chrome") >= 0) {
		$("html").addClass("chrome");
	}
	else if (navigator.userAgent.search("Firefox") >= 0) {
		$("html").addClass("firefox");
	}
	else if (navigator.userAgent.search("Safari") >= 0 && navigator.userAgent.search("Chrome") < 0) {
		$("html").addClass("safari");
	}
	else if (navigator.userAgent.search("Opera") >= 0) {
		$("html").addClass("opera");
	}

});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN1c3RvbS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJjdXN0b20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQ3VzdG9tIHNjcmlwdHMgbGlicmFyeVxyXG4gKlxyXG4gKiBAdmVyc2lvbiAxLjAuOFxyXG4gKi9cclxuXHJcbnZhciAkID0galF1ZXJ5Lm5vQ29uZmxpY3QoKTtcclxudmFyIHdpZHRoO1xyXG5cclxuZnVuY3Rpb24gY2hlY2tNb2JpbGVOYXZnYXRpb24obmF2KSB7XHJcblx0d2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcclxuXHQvL2hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0O1xyXG5cdGlmICghbmF2Lmhhc0NsYXNzKCdidXJnZXInKSlcclxuXHRcdGlmICggd2lkdGggPCA3NjggKSBuYXYuYWRkQ2xhc3MoJ21vYmlsZScpXHJcblx0XHRlbHNlIG5hdi5yZW1vdmVDbGFzcygnbW9iaWxlJylcclxufVxyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsIGZ1bmN0aW9uKGVsKSB7XHJcblx0aWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnaW50ZXJhY3RpdmUnICkge31cclxufSk7XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbigpIHtcclxuXHJcblx0JCgnI2RvbS1wcmVsb2FkZXInKS5mYWRlT3V0KDUwMCwgZnVuY3Rpb24oKSB7ICQoJyNkb20tcHJlbG9hZGVyJykucmVtb3ZlKCk7IH0pO1xyXG5cdCQoJ2JvZHknKS5mYWRlSW4oNTAwKTtcclxuXHR2YXIgb3ZlcmxheSA9ICQoJyNvdmVybGF5Jyk7XHJcblx0dmFyIG5hdmlnYXRpb24gPSAkKCcjaGVhZGVyLW5hdicpO1xyXG5cdGNoZWNrTW9iaWxlTmF2Z2F0aW9uKG5hdmlnYXRpb24pO1xyXG5cdG5hdmlnYXRpb24uY3NzKCdvcGFjaXR5JywgMSk7XHJcblx0dmFyIGJ1cmdlciA9ICQoJyNuYXYtYnVyZ2VyJyk7XHJcblx0dmFyIG1vYmlsZU1lbnUgPSAkKCd1bC5wcmltYXJ5LW1lbnUnKTtcclxuXHR2YXIgbWFpbmhlYWRlciA9ICQoJyNtYWluLWhlYWRlcicpO1xyXG5cdGlmIChtYWluaGVhZGVyKSBtYWluaGVhZGVyLmFkZENsYXNzKCd2aXNpYmxlJyk7XHJcblx0dmFyIHNjcm9sbHVwID0gJCgnI3Njcm9sbC11cCcpO1xyXG5cdHZhciBzZWFyY2ggPSAkKCcjc2l0ZS1zZWFyY2gtbW9kYWwnKTtcclxuXHR2YXIgYmFjazJ0b3AgPSAkKCcjbGluay10by10b3AnKTtcclxuXHR2YXIgZ290b0JhY2sgPSAkKCcjbGluay10by1iYWNrOm5vdCguc2hvdy1pbi10b3ApJyk7XHJcblxyXG5cdHZhciBzdG9wU2Nyb2xsO1xyXG5cdHZhciBzY3JvbGxQb3NfWTtcclxuXHJcblx0ZnVuY3Rpb24gZGlzYWJsZVNjcm9sbCgpIHtcclxuXHRcdHNjcm9sbFBvc19ZID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xyXG5cdFx0c3RvcFNjcm9sbCA9IHRydWU7XHJcblx0XHQkKCdib2R5JykuYWRkQ2xhc3MoJ3Njcm9sbC1kaXNhYmxlZCcpLmNzcygnbWFyZ2luLXRvcCcsIC1zY3JvbGxQb3NfWSArICdweCcpO1xyXG5cclxuXHRcdC8vJCgnI292ZXJsYXkgLmltYWdlLWJveCcpLm9uKFwidG91Y2htb3ZlXCIsIGZ1bmN0aW9uKGUpIHsgZS5zdG9wUHJvcGFnYXRpb24oKTsgfSk7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBlbmFibGVTY3JvbGwoKSB7XHJcblx0XHRzdG9wU2Nyb2xsID0gZmFsc2U7XHJcblx0XHQkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3Njcm9sbC1kaXNhYmxlZCcpLmNzcygnbWFyZ2luLXRvcCcsIDApO1xyXG5cdFx0JCh3aW5kb3cpLnNjcm9sbFRvcChzY3JvbGxQb3NfWSk7XHJcblxyXG5cdFx0Ly8kKCcjb3ZlcmxheSAuaW1hZ2UtYm94JykudW5iaW5kKFwidG91Y2htb3ZlXCIpO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZGlzYWJsZVRvdWNoTW92ZSgpIHtcclxuXHRcdGRvY3VtZW50Lm9udG91Y2htb3ZlID0gZnVuY3Rpb24oZSkgeyBlLnByZXZlbnREZWZhdWx0KCk7IH1cclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gZW5hYmxlVG91Y2hNb3ZlKCkge1xyXG5cdFx0ZG9jdW1lbnQub250b3VjaG1vdmUgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRydWU7IH1cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHRcclxuXHJcblx0Ly8gaW4gdmV3cG9ydCBjaGVjayBzY3JpcHRcclxuXHRpblZpZXcub2Zmc2V0KDIwMCk7XHJcblx0aW5WaWV3KCcjb3ZlcnZpZXctcGFnZSBhcnRpY2xlJylcclxuXHRcdC5vbignZW50ZXInLCBlbCA9PiB7XHJcblx0XHRcdC8vZWwuc3R5bGUub3BhY2l0eSA9IDE7XHJcblx0XHRcdGVsLmNsYXNzTGlzdC5hZGQoJ2xhenlsb2FkZWQnKTtcclxuXHRcdH0pXHJcblx0XHQub24oJ2V4aXQnLCBlbCA9PiB7XHJcblx0XHRcdC8vZWwuc3R5bGUub3BhY2l0eSA9IDAuNTtcclxuXHRcdH0pO1xyXG5cdGluVmlldygnYXJ0aWNsZS5wYWdlJylcclxuXHRcdC5vbignZW50ZXInLCBlbCA9PiB7XHJcblx0XHRcdGVsLmNsYXNzTGlzdC5hZGQoJ2luLXZpZXcnKTtcclxuXHRcdH0pXHJcblxyXG5cdCQoIHdpbmRvdyApLm9uKCAncmVzaXplJywgZnVuY3Rpb24oIGUgKSB7XHJcblx0XHRjaGVja01vYmlsZU5hdmdhdGlvbihuYXZpZ2F0aW9uKTtcclxuXHJcblx0XHRpZiAobW9iaWxlTWVudS5oYXNDbGFzcygnYWN0aXZlJykpIGJ1cmdlci5jbGljaygpOyAvLyBpZiBidXJnZXIgbWVudSBvcGVuIHRoZW4gY2xvc2UgaXRcclxuXHR9KTtcclxuXHJcblx0JCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpIHtcclxuXHRcdC8vYWRkVmlzaWJsZUNsYXNzKGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvckFsbCgnYXJ0aWNsZScpKTsgLy92aWV3cG9ydC5qc1xyXG5cclxuXHRcdGJhY2sydG9wICYmIGJhY2sydG9wLnRvcEJ0blRvZ2dsZSh7XHJcblx0XHRcdHNjcm9sbFRyaWdnZXI6IDEwMDAsXHJcblx0XHRcdC8vZGVidWc6IHRydWUsXHJcblx0XHR9KTtcclxuXHJcblx0XHRnb3RvQmFjayAmJiBnb3RvQmFjay50b3BCdG5Ub2dnbGUoe1xyXG5cdFx0XHRzY3JvbGxUcmlnZ2VyOiAxMDAwLFxyXG5cdFx0XHQvL2RlYnVnOiB0cnVlLFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0aWYgKCAkKCdib2R5JykuaGFzKCcucGFyYWxsYXgnKS5sZW5ndGggKSB7XHJcblx0XHRcdC8vIGluaXQgcGFyYWxsYXggZm9yIGJhY2tncm91bmRcclxuXHRcdFx0JCgnLnBhcmFsbGF4JykuYmdQYXJhbGxheCh7XHJcblx0XHRcdFx0Ymdwb3NpdGlvblk6IDUwLCAvL2l0IG11c3QgYmUgdGhlIHNhbWUgYmFja2dyb3VuZC1wb3NpdGlvbiB2YWx1ZSBpbiBjc3NcclxuXHRcdFx0XHRzcGVlZDogMC41LFxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblxyXG4vKlxyXG4vLyBDbGljayBldmVudCBvbiBsaW5rIHN0YXJ0aW5nIGZyb20gIyBmb3IgbGFuZGluZyBwYWdlXHJcblx0JCgnYVtocmVmXj1cIiNcIl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0dmFyIHRhcmdldCA9ICQodGhpcykuYXR0cignaHJlZicpO1xyXG5cdFx0aWYgKCB0YXJnZXQubGVuZ3RoID4gMSAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT0gJy8nICYmIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggPT0gJycpIHsgLy9pZiBob21lIHBhZ2UgYW5kIG5vIHNlYXJjaCBxdWVyeSBhbmQgbm8gb25seSAjXHJcblx0XHRcdC8vaWYgKCQodGFyZ2V0KS5oYXNDbGFzcygnYW5pbWF0ZScpKSAkKHRhcmdldCkucmVtb3ZlQ2xhc3MoJ2FuaW1hdGUnKTtcclxuXHRcdFx0aWYgKGJ1cmdlci5pcygnOnZpc2libGUnKSkgYnVyZ2VyLmNsaWNrKCk7IC8vY2xvc2UgYnVyZ2VyIG1lbnUgb24gbGluayBjbGlja2luZ1xyXG5cclxuXHRcdFx0dmFyIHRvcCA9ICQodGFyZ2V0KS5vZmZzZXQoKS50b3A7XHJcblx0XHRcdCQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6IHRvcH0sIDUwMCt0b3AvNCk7IC8vODAwIC0g0LTQu9C40YLQtdC70YzQvdC+0YHRgtGMINGB0LrRgNC+0LvQu9C40L3Qs9CwINCyINC80YFcdFx0XHRcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdC8vdGFyZ2V0ID0gdGFyZ2V0LnJlcGxhY2UoL1teQS1aYS16XS9nLCBcIlwiKTtcclxuXHRcdFx0bG9jYXRpb24ucmVwbGFjZSgnLycrdGFyZ2V0KTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcbiovXHJcbi8qXHJcblx0YnVyZ2VyLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRpZiAoYnVyZ2VyLmlzKCc6dmlzaWJsZScpKSB7XHJcblx0XHRcdGJ1cmdlci50b2dnbGVDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdCQoJyNtZW51LXRvcCcpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcclxuXHRcdFx0JChkb2N1bWVudC5ib2R5KS50b2dnbGVDbGFzcygnbW9kYWwnKTtcclxuXHRcdH1cclxuXHR9KTtcclxuKi9cclxuXHQvL05ldyB2ZXJzaW9uIHdpdGggb3duIGNsb3NlIGJ1dHRvbiBpbiBtZW51XHJcblx0YnVyZ2VyLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRpZiAoIW1vYmlsZU1lbnUuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XHJcblx0XHRcdG1vYmlsZU1lbnUucHJlcGVuZCgnPGRpdiBjbGFzcz1cImNsb3NlLWljb25cIj48L2Rpdj4nKTtcclxuXHRcdFx0Ly9idXJnZXIudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHRtb2JpbGVNZW51LmFkZENsYXNzKCdhY3RpdmUnKTtcclxuXHRcdFx0Ly8kKGRvY3VtZW50LmJvZHkpLnRvZ2dsZUNsYXNzKCdtb2RhbCcpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRtb2JpbGVNZW51Lm9uKCdjbGljaycsJy5jbG9zZS1pY29uJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdG1vYmlsZU1lbnUucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpLmNoaWxkcmVuKCkucmVtb3ZlKCcuY2xvc2UtaWNvbicpO1xyXG5cdH0pO1xyXG5cdFxyXG5cdHZhciBzdWJtZW51X2l0ZW0gPSAkKCcubWVudS1pdGVtLWhhcy1jaGlsZHJlbiBhJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdCQodGhpcykucGFyZW50KCkudG9nZ2xlQ2xhc3MoJ2NvbGxhcHNlZCcpO1xyXG5cdH0pO1xyXG5cdFx0XHJcblx0JCggZG9jdW1lbnQgKS5vbiggJ2tleXVwJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdGlmKCBlLmtleUNvZGUgPT0gMjcgJiYgIXNlYXJjaC5oYXNDbGFzcygnaGlkZGVuJykgKVxyXG5cdFx0XHQvL2Nsb3NlIHNlYXJjaCBmb3JtXHJcblx0XHRcdHNlYXJjaC5hZGRDbGFzcygnaGlkZGVuJykgLy9pZiggZS5rZXlDb2RlID09IDI3ICYmIHNlYXJjaC5pcygnOnZpc2libGUnKSApIHNlYXJjaC5mYWRlVG9nZ2xlKDMwMClcclxuXHRcdGVsc2VcclxuXHRcdGlmKCBlLmtleUNvZGUgPT0gMjcgJiYgIW92ZXJsYXkuaGFzQ2xhc3MoJ2hpZGRlbicpIClcclxuXHRcdFx0b3ZlcmxheS5jbGljaygpIC8vY2xvc2Ugb3ZlcmxheSBmb3JtXHJcblx0XHRlbHNlIC8vY2xvc2UgYnVyZ2VyIG1lbnUgb24gZXNjIGtleVxyXG5cdFx0aWYoIGUua2V5Q29kZSA9PSAyNyAmJiBtb2JpbGVNZW51Lmhhc0NsYXNzKCdhY3RpdmUnKSApIG1vYmlsZU1lbnUuY2hpbGRyZW4oJy5jbG9zZS1pY29uJykuY2xpY2soKTsgLy8gaWYoIGUua2V5Q29kZSA9PSAyNyAmJiBidXJnZXIuaGFzQ2xhc3MoJ2FjdGl2ZScpICkgYnVyZ2VyLmNsaWNrKCk7XHJcblx0fSk7XHJcblxyXG5cclxuXHRzY3JvbGx1cC5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0dmFyIG1jID0gZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCcjbWFpbi1jb250YWluZXInKTtcclxuXHRcdHNjcm9sbHVwXHJcblx0XHQuZmFkZU91dCgnc2xvdycpXHJcblx0XHQuZGVsYXkoNTAwKVxyXG5cdFx0LnJlbW92ZSgpXHJcblx0XHQuZGVsYXkoNTAwKVxyXG5cdFx0LnF1ZXVlKCBmdW5jdGlvbigpIHtcclxuXHRcdFx0bWMuc2Nyb2xsSW50b1ZpZXcoe2Jsb2NrOiBcInN0YXJ0XCIsIGJlaGF2aW9yOiBcInNtb290aFwifSk7XHJcblx0XHR9KTtcclxuXHR9KTtcclxuXHJcblx0YmFjazJ0b3Aub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdC8vIDgwMCAtINGB0LrQvtGA0L7RgdGC0Ywg0LfQsNC00LXRgNC20LrQuCDQv9C10YDQtdC80LXRidC10L3QuNGPINC90LDQstC10YDRhSAo0LIg0LzQuNC70LvQuNGB0LXQutGD0L3QtNCw0YUpXHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHQkKCdodG1sLGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6IDB9LCA4MDApO1xyXG5cdH0pO1xyXG5cclxuXHQkKCcjbmF2LXNlYXJjaCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRpZiAoICFzZWFyY2guYXR0cignZGlzcGxheScsJ25vbmUnKSAmJiBzZWFyY2guZmluZCgnI3MnKS52YWwoKSApIHtcclxuXHRcdFx0JCgnI3NlYXJjaGZvcm0nKS5zdWJtaXQoKTsgXHJcblx0XHR9IGVsc2Ugc2VhcmNoLmZhZGVUb2dnbGUoMzAwKTtcclxuXHR9KTtcclxuLypcclxuXHQkKCcjbmF2LXNlYXJjaCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRzZWFyY2gudG9nZ2xlQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdH0pO1xyXG5cclxuXHQkKCcjc2VhcmNoZm9ybScpLm9uKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0Ly/QuNC00LXRgiDQv9C+0LjRgdC6Li4uXHJcblx0XHQvL9C80L7QttC90L4g0LLRi9Cy0LXRgdGC0LggcHJlbG9hZGVyINGBINC90LDQtNC/0LjRgdGM0Y5cclxuXHR9KTtcclxuXHQkKCcjc2VhcmNoZm9ybS1jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHR2YXIgZmllbGRfcyA9IHNlYXJjaC5maW5kKCcjcycpO1xyXG5cdFx0aWYgKCBmaWVsZF9zLnZhbCgpICkgZmllbGRfcy52YWwoJycpXHJcblx0XHRlbHNlIHNlYXJjaC5mYWRlVG9nZ2xlKDMwMCk7XHJcblx0fSk7XHJcbiovXHJcblx0c2VhcmNoLm9uKCdjbGljaycsJy5jbG9zZS1pY29uJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdHNlYXJjaC5hZGRDbGFzcygnaGlkZGVuJyk7XHJcblx0fSk7XHJcblxyXG5cdG92ZXJsYXkub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdCQodGhpcykuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdFx0ZW5hYmxlU2Nyb2xsKCk7XHJcblx0fSk7XHJcblxyXG5cdGlmICggJCgnLmpjYXJvdXNlbCcpLmhhcygnbGkuc2xpZGUnKS5sZW5ndGggKSB7XHJcblxyXG5cdFx0JCgnW2RhdGEtamNhcm91c2VsXScpLmVhY2goZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciBlbCA9ICQodGhpcyk7XHJcblx0XHRcdGVsLmpjYXJvdXNlbChlbC5kYXRhKCkpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0dmFyIHhTdGFydCwgeVN0YXJ0O1xyXG5cdFx0dmFyIHN0b3BUb3VjaDtcclxuXHRcdHZhciBzbGlkZXNQZXJQYWdlID0gMTtcclxuXHJcblx0XHR2YXIgY2Fyb3VzZWwgPSAkKCcuamNhcm91c2VsJyk7XHJcblx0XHRjYXJvdXNlbFxyXG5cdFx0XHQub24oJ2pjYXJvdXNlbDpjcmVhdGUgamNhcm91c2VsOnJlbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHZhciBjYXJvdXNlbF93ID0gY2Fyb3VzZWwucGFyZW50KCkuaW5uZXJXaWR0aCgpLFxyXG5cdFx0XHRcdFx0Y2Fyb3VzZWxfaCA9IGNhcm91c2VsLnBhcmVudCgpLmlubmVySGVpZ2h0KCk7XHJcblxyXG5cdFx0XHRcdHNsaWRlc1BlclBhZ2UgPSAoY2Fyb3VzZWxfdyA+IGNhcm91c2VsX2gpID8gTWF0aC50cnVuYyggIGNhcm91c2VsX3cgLyBjYXJvdXNlbF9oICkgOiAxO1xyXG5cclxuXHRcdFx0XHR2YXIgc2xpZGVfd2lkdGggPSBNYXRoLmNlaWwoIGNhcm91c2VsX3cgLyBzbGlkZXNQZXJQYWdlICk7XHJcblx0XHRcdFx0Y2Fyb3VzZWwuamNhcm91c2VsKCdpdGVtcycpLmNzcyhcIndpZHRoXCIsIHNsaWRlX3dpZHRoICsgJ3B4Jyk7XHJcblx0XHRcdH0pXHJcblx0XHRcdC5vbigndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0XHR4U3RhcnQgPSBlLnRvdWNoZXNbMF0uc2NyZWVuWDtcclxuXHRcdFx0XHR5U3RhcnQgPSBlLnRvdWNoZXNbMF0uc2NyZWVuWTtcclxuXHRcdFx0XHRzdG9wVG91Y2ggPSBudWxsO1xyXG5cdFx0XHR9KVxyXG5cdFx0XHQub24oJ3RvdWNobW92ZScsIGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0XHR2YXIgeE1vdmVtZW50ID0gTWF0aC5hYnMoZS50b3VjaGVzWzBdLnNjcmVlblggLSB4U3RhcnQpO1xyXG5cdFx0XHRcdHZhciB5TW92ZW1lbnQgPSBNYXRoLmFicyhlLnRvdWNoZXNbMF0uc2NyZWVuWSAtIHlTdGFydCk7XHJcblx0XHRcdFx0aWYgKHN0b3BUb3VjaCA9PSBudWxsICYmICh4TW92ZW1lbnQgPiAxMCB8fCB5TW92ZW1lbnQgPiAxMCkpXHJcblx0XHRcdFx0XHRzdG9wVG91Y2ggPSAoeU1vdmVtZW50IDwgeE1vdmVtZW50KSA/IGRpc2FibGVUb3VjaE1vdmUoKSA6IGVuYWJsZVRvdWNoTW92ZSgpO1xyXG5cdFx0XHR9KVxyXG5cdFx0XHQub24oJ3RvdWNoZW5kIHRvdWNoY2FuY2VsJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0c3RvcFRvdWNoICYmIGVuYWJsZVRvdWNoTW92ZSgpO1xyXG5cdFx0XHR9KVxyXG5cdFx0XHQub24oJ2pjYXJvdXNlbDpjcmVhdGVlbmQgamNhcm91c2VsOmFuaW1hdGVlbmQnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHQkKHRoaXMpLmpjYXJvdXNlbCgndGFyZ2V0JykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHR9KVxyXG5cdFx0XHQub24oJ2pjYXJvdXNlbDp2aXNpYmxlb3V0JywgJ2xpJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdH0pXHJcblx0XHRcdC5vbignY2xpY2snLCAnbGknLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0XHRcdHZhciBzcmMgPSAkKHRoaXMpLmF0dHIoJ3NyYy11cmwnKTtcclxuXHRcdFx0XHRpZiAoc3JjKSB7XHJcblx0XHRcdFx0XHRzcmMgPSAndXJsKCcrc3JjKycpJztcclxuXHRcdFx0XHRcdC8vdmFyIGJnID0gJChlLnRhcmdldCkuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJyk7XHJcblx0XHRcdFx0XHQvL2JnID0gYmcucmVwbGFjZSgndXJsKCcsJycpLnJlcGxhY2UoJyknLCcnKS5yZXBsYWNlKC9cXFwiL2dpLCBcIlwiKTtcclxuXHRcdFx0XHRcdCFvdmVybGF5LmNoaWxkcmVuKCcuaW1hZ2Vib3gnKS5sZW5ndGggJiYgb3ZlcmxheS5hcHBlbmQoJzxkaXYgY2xhc3M9XCJpbWFnZWJveFwiPjwvZGl2PjxkaXYgY2xhc3M9XCJjbG9zZSBjbG9zZS1pY29uXCIgdGl0bGU9XCJDbG9zZVwiPjwvZGl2PicpO1xyXG5cdFx0XHRcdFx0b3ZlcmxheS5jaGlsZHJlbignLmltYWdlYm94JykuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJywgc3JjKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XHJcblx0XHRcdFx0XHRkaXNhYmxlU2Nyb2xsKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KVxyXG5cdFx0XHQuamNhcm91c2VsKHtcclxuXHRcdFx0XHQvL3Njcm9sbDogc2xpZGVzUGVyUGFnZSxcclxuXHRcdFx0XHQvL2NlbnRlcjogdHJ1ZSxcclxuXHRcdFx0XHR3cmFwOiAnY2lyY3VsYXInLFxyXG5cdFx0XHRcdGFuaW1hdGlvbjogNTAwLFxyXG5cdFx0XHRcdC8vdHJhbnNpdGlvbnM6IHRydWUsXHJcblx0XHRcdFx0dHJhbnNpdGlvbnM6IE1vZGVybml6ci5jc3N0cmFuc2l0aW9ucyA/IHtcclxuXHRcdFx0XHRcdHRyYW5zZm9ybXM6ICAgTW9kZXJuaXpyLmNzc3RyYW5zZm9ybXMsXHJcblx0XHRcdFx0XHR0cmFuc2Zvcm1zM2Q6IE1vZGVybml6ci5jc3N0cmFuc2Zvcm1zM2QsXHJcblx0XHRcdFx0XHRlYXNpbmc6ICAgICAgICdlYXNlJ1xyXG5cdFx0XHRcdH0gOiBmYWxzZVxyXG5cdFx0XHR9KVxyXG5cdFx0XHQvLy5qY2Fyb3VzZWwoJ3Njcm9sbCcsICcrPScrU3RyaW5nKHNsaWRlc1BlclBhZ2UpKVxyXG5cdFx0XHQuamNhcm91c2VsU3dpcGUoe1xyXG5cdFx0XHRcdC8vcGVyU3dpcGU6IHNsaWRlc1BlclBhZ2VcclxuXHRcdFx0XHQvL21ldGhvZDogJ3Njcm9sbEludG9WaWV3JyAvLyBieSBkZWZhdWx0ICdzY3JvbGwnXHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0aWYgKCAndHJ1ZScgPT09IGNhcm91c2VsLmF0dHIoJ2RhdGEtamNhcm91c2VsYXV0b3Njcm9sbCcpICkge1xyXG5cdFx0XHRcdGNhcm91c2VsLmpjYXJvdXNlbEF1dG9zY3JvbGwoe1xyXG5cdFx0XHRcdFx0aW50ZXJ2YWw6ICA1MDAwLFxyXG5cdFx0XHRcdFx0Ly9hdXRvc3RhcnQ6IGZhbHNlLFxyXG5cdFx0XHRcdFx0Ly90YXJnZXQ6ICctPTEnK1N0cmluZyhzbGlkZXNQZXJQYWdlKVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoICQoJy5qY2Fyb3VzZWwtd3JhcHBlcicpLmhhcygnLmpjYXJvdXNlbC1jb250cm9sJykubGVuZ3RoICkge1xyXG5cclxuXHRcdFx0XHQkKCcuamNhcm91c2VsLWNvbnRyb2wucHJldicpXHJcblx0XHRcdFx0XHQub24oJ2pjYXJvdXNlbGNvbnRyb2w6YWN0aXZlJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdCQodGhpcykucmVtb3ZlQ2xhc3MoJ2luYWN0aXZlJyk7XHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0Lm9uKCdqY2Fyb3VzZWxjb250cm9sOmluYWN0aXZlJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdCQodGhpcykuYWRkQ2xhc3MoJ2luYWN0aXZlJyk7XHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0LmpjYXJvdXNlbENvbnRyb2woe1xyXG5cdFx0XHRcdFx0XHQvL3RhcmdldDogJy09JytTdHJpbmcoc2xpZGVzUGVyUGFnZSlcclxuXHRcdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHQkKCcuamNhcm91c2VsLWNvbnRyb2wubmV4dCcpXHJcblx0XHRcdFx0XHQub24oJ2pjYXJvdXNlbGNvbnRyb2w6YWN0aXZlJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdCQodGhpcykucmVtb3ZlQ2xhc3MoJ2luYWN0aXZlJyk7XHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0Lm9uKCdqY2Fyb3VzZWxjb250cm9sOmluYWN0aXZlJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdCQodGhpcykuYWRkQ2xhc3MoJ2luYWN0aXZlJyk7XHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0LmpjYXJvdXNlbENvbnRyb2woe1xyXG5cdFx0XHRcdFx0XHQvL3RhcmdldDogJys9JytTdHJpbmcoc2xpZGVzUGVyUGFnZSlcclxuXHRcdFx0XHRcdH0pO1xyXG5cdC8qXHJcblx0XHRcdFx0aWYgKCAhJChcImh0bWxcIikuaGFzKFwibW9iaWxlXCIpICkge1xyXG5cdFx0XHRcdFx0JChcIi5qY2Fyb3VzZWwtd3JhcHBlclwiKS5ob3ZlciggZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdCQoJy5qY2Fyb3VzZWwtY29udHJvbCcpLmZhZGVJbigzMDApO1xyXG5cdFx0XHRcdFx0fSwgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdCQoJy5qY2Fyb3VzZWwtY29udHJvbCcpLmZhZGVPdXQoMzAwKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH1cclxuXHQqL1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdGlmICggJCgnLmpjYXJvdXNlbC13cmFwcGVyJykuaGFzKCcuamNhcm91c2VsLXBhZ2luYXRpb24nKS5sZW5ndGggJiYgJ3RydWUnID09PSAkKCcuamNhcm91c2VsLXBhZ2luYXRpb24nKS5hdHRyKCdkYXRhLWpjYXJvdXNlbHBhZ2luYXRpb24nKSApIHtcclxuXHRcdFx0JCgnLmpjYXJvdXNlbC1wYWdpbmF0aW9uJylcclxuXHRcdFx0XHQub24oJ2pjYXJvdXNlbHBhZ2luYXRpb246YWN0aXZlJywgJ2EnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdCQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0Lm9uKCdqY2Fyb3VzZWxwYWdpbmF0aW9uOmluYWN0aXZlJywgJ2EnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdCQodGhpcykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0LmpjYXJvdXNlbFBhZ2luYXRpb24oe1xyXG5cdFx0XHRcdFx0Ly8ncGVyUGFnZSc6IHNsaWRlc1BlclBhZ2VcclxuXHRcdFx0XHR9KTtcclxuXHRcdH0gZWxzZSAkKCcuamNhcm91c2VsLXBhZ2luYXRpb24nKS5yZW1vdmUoKTtcclxuXHJcblx0fVxyXG5cclxuXHQvL0FkZGluZyBhbiBhZ2VudCB0byBIVE1MIHNlbGVjdG9yXHJcblx0dmFyIGRldmljZUFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO1xyXG5cdGlmIChkZXZpY2VBZ2VudC5tYXRjaCgvKGlwaG9uZXxpcG9kfGlwYWQpLykpIHtcclxuXHRcdCQoXCJodG1sXCIpLmFkZENsYXNzKFwibW9iaWxlXCIpO1xyXG5cdFx0JChcImh0bWxcIikuYWRkQ2xhc3MoXCJpb3NcIik7XHJcblx0fVxyXG5cdGlmIChuYXZpZ2F0b3IudXNlckFnZW50LnNlYXJjaChcIk1TSUVcIikgPj0gMCkge1xyXG5cdFx0JChcImh0bWxcIikuYWRkQ2xhc3MoXCJpZVwiKTtcclxuXHR9XHJcblx0ZWxzZSBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5zZWFyY2goXCJDaHJvbWVcIikgPj0gMCkge1xyXG5cdFx0JChcImh0bWxcIikuYWRkQ2xhc3MoXCJjaHJvbWVcIik7XHJcblx0fVxyXG5cdGVsc2UgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuc2VhcmNoKFwiRmlyZWZveFwiKSA+PSAwKSB7XHJcblx0XHQkKFwiaHRtbFwiKS5hZGRDbGFzcyhcImZpcmVmb3hcIik7XHJcblx0fVxyXG5cdGVsc2UgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuc2VhcmNoKFwiU2FmYXJpXCIpID49IDAgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5zZWFyY2goXCJDaHJvbWVcIikgPCAwKSB7XHJcblx0XHQkKFwiaHRtbFwiKS5hZGRDbGFzcyhcInNhZmFyaVwiKTtcclxuXHR9XHJcblx0ZWxzZSBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5zZWFyY2goXCJPcGVyYVwiKSA+PSAwKSB7XHJcblx0XHQkKFwiaHRtbFwiKS5hZGRDbGFzcyhcIm9wZXJhXCIpO1xyXG5cdH1cclxuXHJcbn0pO1xyXG4iXX0=
