/*
 * Custom scripts library
 *
 * @version 1.0.8
 */

var $ = jQuery.noConflict();
var width;

function checkMobileNavgation(nav) {
	width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
	//height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
	if (!nav.hasClass('burger'))
		if ( width < 768 ) nav.addClass('mobile')
		else nav.removeClass('mobile')
}

document.addEventListener('readystatechange', function(el) {
	if ( document.readyState === 'interactive' ) {}
});

document.addEventListener("DOMContentLoaded", function() {

	$('#dom-preloader').fadeOut(500, function() { 
		//$('#dom-preloader').remove(); 
	});
	$('body').fadeIn(500);
	var overlay = $('#overlay');
	var navigation = $('#header-nav');
	checkMobileNavgation(navigation);
	navigation.css('opacity', 1);
	var burger = $('#nav-burger');
	var mobileMenu = $('ul.primary-menu');
	var mainheader = $('#main-header');
	if (mainheader) mainheader.addClass('visible');
	var scrollup = $('#scroll-up');
	var search = $('#site-search-modal');
	var back2top = $('#link-to-top');
	var gotoBack = $('#link-to-back:not(.show-in-top)');

	var stopScroll;
	var scrollPos_Y;

	function disableScroll() {
		scrollPos_Y = $(window).scrollTop();
		stopScroll = true;
		$('body').addClass('scroll-disabled').css('margin-top', -scrollPos_Y + 'px');

		//$('#overlay .image-box').on("touchmove", function(e) { e.stopPropagation(); });
	}

	function enableScroll() {
		stopScroll = false;
		$('body').removeClass('scroll-disabled').css('margin-top', 0);
		$(window).scrollTop(scrollPos_Y);

		//$('#overlay .image-box').unbind("touchmove");
	}

	function disableTouchMove() {
		document.ontouchmove = function(e) { e.preventDefault(); }
		return true;
	}

	function enableTouchMove() {
		document.ontouchmove = function() { return true; }
		return false;
	}	

	// in vewport check script
	inView.offset(200);
	inView('#overview-page article')
		.on('enter', el => {
			//el.style.opacity = 1;
			el.classList.add('lazyloaded');
		})
		.on('exit', el => {
			//el.style.opacity = 0.5;
		});
	inView('article.page')
		.on('enter', el => {
			el.classList.add('in-view');
		})

	$( window ).on( 'resize', function( e ) {
		checkMobileNavgation(navigation);

		if (mobileMenu.hasClass('active')) burger.click(); // if burger menu open then close it
	});

	$(window).scroll(function() {
		//addVisibleClass(document.body.querySelectorAll('article')); //viewport.js

		back2top && back2top.topBtnToggle({
			scrollTrigger: 1000,
			//debug: true,
		});

		gotoBack && gotoBack.topBtnToggle({
			scrollTrigger: 1000,
			//debug: true,
		});

		if ( $('body').has('.parallax').length ) {
			// init parallax for background
			$('.parallax').bgParallax({
				bgpositionY: 50, //it must be the same background-position value in css
				speed: 0.5,
			});
		}
	});


/*
// Click event on link starting from # for landing page
	$('a[href^="#"]').on('click', function (e) {
		e.preventDefault();
		var target = $(this).attr('href');
		if ( target.length > 1 && window.location.pathname == '/' && window.location.search == '') { //if home page and no search query and no only #
			//if ($(target).hasClass('animate')) $(target).removeClass('animate');
			if (burger.is(':visible')) burger.click(); //close burger menu on link clicking

			var top = $(target).offset().top;
			$('html, body').animate({scrollTop: top}, 500+top/4); //800 - длительность скроллинга в мс			
		} else {
			//target = target.replace(/[^A-Za-z]/g, "");
			location.replace('/'+target);
		}
	});

*/
/*
	burger.on('click', function (e) {
		if (burger.is(':visible')) {
			burger.toggleClass('active');
			$('#menu-top').toggleClass('active');
			$(document.body).toggleClass('modal');
		}
	});
*/
	//New version with own close button in menu
	burger.on('click', function (e) {
		if (!mobileMenu.hasClass('active')) {
			mobileMenu.prepend('<div class="close-icon"></div>');
			//burger.toggleClass('active');
			mobileMenu.addClass('active');
			//$(document.body).toggleClass('modal');
		}
	});

	mobileMenu.on('click','.close-icon', function (e) {
		mobileMenu.removeClass('active').children().remove('.close-icon');
	});
	
	var submenu_item = $('.menu-item-has-children a').on('click', function (e) {
		e.preventDefault();
		$(this).parent().toggleClass('collapsed');
	});
		
	$( document ).on( 'keyup', function (e) {
		e.preventDefault();
		if( e.keyCode == 27 && !search.hasClass('hidden') )
			//close search form
			search.addClass('hidden') //if( e.keyCode == 27 && search.is(':visible') ) search.fadeToggle(300)
		else
		if( e.keyCode == 27 && !overlay.hasClass('hidden') )
			overlay.click() //close overlay form
		else //close burger menu on esc key
		if( e.keyCode == 27 && mobileMenu.hasClass('active') ) mobileMenu.children('.close-icon').click(); // if( e.keyCode == 27 && burger.hasClass('active') ) burger.click();
	});


	scrollup.on('click', function (e) {
		var mc = document.body.querySelector('#main-container');
		scrollup
		.fadeOut('slow')
		.delay(500)
		.remove()
		.delay(500)
		.queue( function() {
			mc.scrollIntoView({block: "start", behavior: "smooth"});
		});
	});

	back2top.on('click', function (e) {
		// 800 - скорость задержки перемещения наверх (в миллисекундах)
		e.preventDefault();
		$('html,body').animate({scrollTop: 0}, 800);
	});

	$('#nav-search').on('click', function (e) {
		if ( !search.attr('display','none') && search.find('#s').val() ) {
			$('#searchform').submit(); 
		} else search.fadeToggle(300);
	});
/*
	$('#nav-search').on('click', function (e) {
		search.toggleClass('hidden');
	});

	$('#searchform').on('submit', function (e) {
		//идет поиск...
		//можно вывести preloader с надписью
	});
	$('#searchform-close').on('click', function (e) {
		var field_s = search.find('#s');
		if ( field_s.val() ) field_s.val('')
		else search.fadeToggle(300);
	});
*/
	search.on('click','.close-icon', function (e) {
		search.addClass('hidden');
	});

	overlay.on('click', function (e) {
		$(this).addClass('hidden');
		enableScroll();
	});

	if ( $('.jcarousel').has('li.slide').length ) {

		$('[data-jcarousel]').each(function() {
			var el = $(this);
			el.jcarousel(el.data());
		});

		var xStart, yStart;
		var stopTouch;
		var slidesPerPage = 1;

		var carousel = $('.jcarousel');
		carousel
			.on('jcarousel:create jcarousel:reload', function() {
				var carousel_w = carousel.parent().innerWidth(),
					carousel_h = carousel.parent().innerHeight();

				slidesPerPage = (carousel_w > carousel_h) ? Math.trunc(  carousel_w / carousel_h ) : 1;

				var slide_width = Math.ceil( carousel_w / slidesPerPage );
				carousel.jcarousel('items').css("width", slide_width + 'px');
			})
			.on('touchstart', function(e) {
				xStart = e.touches[0].screenX;
				yStart = e.touches[0].screenY;
				stopTouch = null;
			})
			.on('touchmove', function(e) {
				var xMovement = Math.abs(e.touches[0].screenX - xStart);
				var yMovement = Math.abs(e.touches[0].screenY - yStart);
				if (stopTouch == null && (xMovement > 10 || yMovement > 10))
					stopTouch = (yMovement < xMovement) ? disableTouchMove() : enableTouchMove();
			})
			.on('touchend touchcancel', function() {
				stopTouch && enableTouchMove();
			})
			.on('jcarousel:createend jcarousel:animateend', function() {
				$(this).jcarousel('target').addClass('active');
			})
			.on('jcarousel:visibleout', 'li', function() {
				$(this).removeClass('active');
			})
			.on('click', 'li', function (e) {
				var src = $(this).attr('src-url');
				if (src) {
					src = 'url('+src+')';
					//var bg = $(e.target).css('background-image');
					//bg = bg.replace('url(','').replace(')','').replace(/\"/gi, "");
					!overlay.children('.imagebox').length && overlay.append('<div class="imagebox"></div><div class="close close-icon" title="Close"></div>');
					overlay.children('.imagebox').css('background-image', src).parent().removeClass('hidden');
					disableScroll();
				}
			})
			.jcarousel({
				//scroll: slidesPerPage,
				//center: true,
				wrap: 'circular',
				animation: 500,
				//transitions: true,
				transitions: Modernizr.csstransitions ? {
					transforms:   Modernizr.csstransforms,
					transforms3d: Modernizr.csstransforms3d,
					easing:       'ease'
				} : false
			})
			//.jcarousel('scroll', '+='+String(slidesPerPage))
			.jcarouselSwipe({
				//perSwipe: slidesPerPage
				//method: 'scrollIntoView' // by default 'scroll'
			});

			if ( 'true' === carousel.attr('data-jcarouselautoscroll') ) {
				carousel.jcarouselAutoscroll({
					interval:  5000,
					//autostart: false,
					//target: '-=1'+String(slidesPerPage)
				});
			}

			if ( $('.jcarousel-wrapper').has('.jcarousel-control').length ) {

				$('.jcarousel-control.prev')
					.on('jcarouselcontrol:active', function() {
						$(this).removeClass('inactive');
					})
					.on('jcarouselcontrol:inactive', function() {
						$(this).addClass('inactive');
					})
					.jcarouselControl({
						//target: '-='+String(slidesPerPage)
					});

				$('.jcarousel-control.next')
					.on('jcarouselcontrol:active', function() {
						$(this).removeClass('inactive');
					})
					.on('jcarouselcontrol:inactive', function() {
						$(this).addClass('inactive');
					})
					.jcarouselControl({
						//target: '+='+String(slidesPerPage)
					});
	/*
				if ( !$("html").has("mobile") ) {
					$(".jcarousel-wrapper").hover( function() {
						$('.jcarousel-control').fadeIn(300);
					}, function() {
						$('.jcarousel-control').fadeOut(300);
					});
				}
	*/

			}

		if ( $('.jcarousel-wrapper').has('.jcarousel-pagination').length && 'true' === $('.jcarousel-pagination').attr('data-jcarouselpagination') ) {
			$('.jcarousel-pagination')
				.on('jcarouselpagination:active', 'a', function() {
					$(this).addClass('active');
				})
				.on('jcarouselpagination:inactive', 'a', function() {
					$(this).removeClass('active');
				})
				.jcarouselPagination({
					//'perPage': slidesPerPage
				});
		} else $('.jcarousel-pagination').remove();

	}

	//Adding an agent to HTML selector
	var deviceAgent = navigator.userAgent.toLowerCase();
	if (deviceAgent.match(/(iphone|ipod|ipad)/)) {
		$("html").addClass("mobile");
		$("html").addClass("ios");
	}
	if (navigator.userAgent.search("MSIE") >= 0) {
		$("html").addClass("ie");
	}
	else if (navigator.userAgent.search("Chrome") >= 0) {
		$("html").addClass("chrome");
	}
	else if (navigator.userAgent.search("Firefox") >= 0) {
		$("html").addClass("firefox");
	}
	else if (navigator.userAgent.search("Safari") >= 0 && navigator.userAgent.search("Chrome") < 0) {
		$("html").addClass("safari");
	}
	else if (navigator.userAgent.search("Opera") >= 0) {
		$("html").addClass("opera");
	}

});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN1c3RvbS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiY3VzdG9tLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEN1c3RvbSBzY3JpcHRzIGxpYnJhcnlcclxuICpcclxuICogQHZlcnNpb24gMS4wLjhcclxuICovXHJcblxyXG52YXIgJCA9IGpRdWVyeS5ub0NvbmZsaWN0KCk7XHJcbnZhciB3aWR0aDtcclxuXHJcbmZ1bmN0aW9uIGNoZWNrTW9iaWxlTmF2Z2F0aW9uKG5hdikge1xyXG5cdHdpZHRoID0gd2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7XHJcblx0Ly9oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDtcclxuXHRpZiAoIW5hdi5oYXNDbGFzcygnYnVyZ2VyJykpXHJcblx0XHRpZiAoIHdpZHRoIDwgNzY4ICkgbmF2LmFkZENsYXNzKCdtb2JpbGUnKVxyXG5cdFx0ZWxzZSBuYXYucmVtb3ZlQ2xhc3MoJ21vYmlsZScpXHJcbn1cclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWR5c3RhdGVjaGFuZ2UnLCBmdW5jdGlvbihlbCkge1xyXG5cdGlmICggZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2ludGVyYWN0aXZlJyApIHt9XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZnVuY3Rpb24oKSB7XHJcblxyXG5cdCQoJyNkb20tcHJlbG9hZGVyJykuZmFkZU91dCg1MDAsIGZ1bmN0aW9uKCkgeyBcclxuXHRcdC8vJCgnI2RvbS1wcmVsb2FkZXInKS5yZW1vdmUoKTsgXHJcblx0fSk7XHJcblx0JCgnYm9keScpLmZhZGVJbig1MDApO1xyXG5cdHZhciBvdmVybGF5ID0gJCgnI292ZXJsYXknKTtcclxuXHR2YXIgbmF2aWdhdGlvbiA9ICQoJyNoZWFkZXItbmF2Jyk7XHJcblx0Y2hlY2tNb2JpbGVOYXZnYXRpb24obmF2aWdhdGlvbik7XHJcblx0bmF2aWdhdGlvbi5jc3MoJ29wYWNpdHknLCAxKTtcclxuXHR2YXIgYnVyZ2VyID0gJCgnI25hdi1idXJnZXInKTtcclxuXHR2YXIgbW9iaWxlTWVudSA9ICQoJ3VsLnByaW1hcnktbWVudScpO1xyXG5cdHZhciBtYWluaGVhZGVyID0gJCgnI21haW4taGVhZGVyJyk7XHJcblx0aWYgKG1haW5oZWFkZXIpIG1haW5oZWFkZXIuYWRkQ2xhc3MoJ3Zpc2libGUnKTtcclxuXHR2YXIgc2Nyb2xsdXAgPSAkKCcjc2Nyb2xsLXVwJyk7XHJcblx0dmFyIHNlYXJjaCA9ICQoJyNzaXRlLXNlYXJjaC1tb2RhbCcpO1xyXG5cdHZhciBiYWNrMnRvcCA9ICQoJyNsaW5rLXRvLXRvcCcpO1xyXG5cdHZhciBnb3RvQmFjayA9ICQoJyNsaW5rLXRvLWJhY2s6bm90KC5zaG93LWluLXRvcCknKTtcclxuXHJcblx0dmFyIHN0b3BTY3JvbGw7XHJcblx0dmFyIHNjcm9sbFBvc19ZO1xyXG5cclxuXHRmdW5jdGlvbiBkaXNhYmxlU2Nyb2xsKCkge1xyXG5cdFx0c2Nyb2xsUG9zX1kgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XHJcblx0XHRzdG9wU2Nyb2xsID0gdHJ1ZTtcclxuXHRcdCQoJ2JvZHknKS5hZGRDbGFzcygnc2Nyb2xsLWRpc2FibGVkJykuY3NzKCdtYXJnaW4tdG9wJywgLXNjcm9sbFBvc19ZICsgJ3B4Jyk7XHJcblxyXG5cdFx0Ly8kKCcjb3ZlcmxheSAuaW1hZ2UtYm94Jykub24oXCJ0b3VjaG1vdmVcIiwgZnVuY3Rpb24oZSkgeyBlLnN0b3BQcm9wYWdhdGlvbigpOyB9KTtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGVuYWJsZVNjcm9sbCgpIHtcclxuXHRcdHN0b3BTY3JvbGwgPSBmYWxzZTtcclxuXHRcdCQoJ2JvZHknKS5yZW1vdmVDbGFzcygnc2Nyb2xsLWRpc2FibGVkJykuY3NzKCdtYXJnaW4tdG9wJywgMCk7XHJcblx0XHQkKHdpbmRvdykuc2Nyb2xsVG9wKHNjcm9sbFBvc19ZKTtcclxuXHJcblx0XHQvLyQoJyNvdmVybGF5IC5pbWFnZS1ib3gnKS51bmJpbmQoXCJ0b3VjaG1vdmVcIik7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBkaXNhYmxlVG91Y2hNb3ZlKCkge1xyXG5cdFx0ZG9jdW1lbnQub250b3VjaG1vdmUgPSBmdW5jdGlvbihlKSB7IGUucHJldmVudERlZmF1bHQoKTsgfVxyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBlbmFibGVUb3VjaE1vdmUoKSB7XHJcblx0XHRkb2N1bWVudC5vbnRvdWNobW92ZSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfVxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH1cdFxyXG5cclxuXHQvLyBpbiB2ZXdwb3J0IGNoZWNrIHNjcmlwdFxyXG5cdGluVmlldy5vZmZzZXQoMjAwKTtcclxuXHRpblZpZXcoJyNvdmVydmlldy1wYWdlIGFydGljbGUnKVxyXG5cdFx0Lm9uKCdlbnRlcicsIGVsID0+IHtcclxuXHRcdFx0Ly9lbC5zdHlsZS5vcGFjaXR5ID0gMTtcclxuXHRcdFx0ZWwuY2xhc3NMaXN0LmFkZCgnbGF6eWxvYWRlZCcpO1xyXG5cdFx0fSlcclxuXHRcdC5vbignZXhpdCcsIGVsID0+IHtcclxuXHRcdFx0Ly9lbC5zdHlsZS5vcGFjaXR5ID0gMC41O1xyXG5cdFx0fSk7XHJcblx0aW5WaWV3KCdhcnRpY2xlLnBhZ2UnKVxyXG5cdFx0Lm9uKCdlbnRlcicsIGVsID0+IHtcclxuXHRcdFx0ZWwuY2xhc3NMaXN0LmFkZCgnaW4tdmlldycpO1xyXG5cdFx0fSlcclxuXHJcblx0JCggd2luZG93ICkub24oICdyZXNpemUnLCBmdW5jdGlvbiggZSApIHtcclxuXHRcdGNoZWNrTW9iaWxlTmF2Z2F0aW9uKG5hdmlnYXRpb24pO1xyXG5cclxuXHRcdGlmIChtb2JpbGVNZW51Lmhhc0NsYXNzKCdhY3RpdmUnKSkgYnVyZ2VyLmNsaWNrKCk7IC8vIGlmIGJ1cmdlciBtZW51IG9wZW4gdGhlbiBjbG9zZSBpdFxyXG5cdH0pO1xyXG5cclxuXHQkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCkge1xyXG5cdFx0Ly9hZGRWaXNpYmxlQ2xhc3MoZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yQWxsKCdhcnRpY2xlJykpOyAvL3ZpZXdwb3J0LmpzXHJcblxyXG5cdFx0YmFjazJ0b3AgJiYgYmFjazJ0b3AudG9wQnRuVG9nZ2xlKHtcclxuXHRcdFx0c2Nyb2xsVHJpZ2dlcjogMTAwMCxcclxuXHRcdFx0Ly9kZWJ1ZzogdHJ1ZSxcclxuXHRcdH0pO1xyXG5cclxuXHRcdGdvdG9CYWNrICYmIGdvdG9CYWNrLnRvcEJ0blRvZ2dsZSh7XHJcblx0XHRcdHNjcm9sbFRyaWdnZXI6IDEwMDAsXHJcblx0XHRcdC8vZGVidWc6IHRydWUsXHJcblx0XHR9KTtcclxuXHJcblx0XHRpZiAoICQoJ2JvZHknKS5oYXMoJy5wYXJhbGxheCcpLmxlbmd0aCApIHtcclxuXHRcdFx0Ly8gaW5pdCBwYXJhbGxheCBmb3IgYmFja2dyb3VuZFxyXG5cdFx0XHQkKCcucGFyYWxsYXgnKS5iZ1BhcmFsbGF4KHtcclxuXHRcdFx0XHRiZ3Bvc2l0aW9uWTogNTAsIC8vaXQgbXVzdCBiZSB0aGUgc2FtZSBiYWNrZ3JvdW5kLXBvc2l0aW9uIHZhbHVlIGluIGNzc1xyXG5cdFx0XHRcdHNwZWVkOiAwLjUsXHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHJcbi8qXHJcbi8vIENsaWNrIGV2ZW50IG9uIGxpbmsgc3RhcnRpbmcgZnJvbSAjIGZvciBsYW5kaW5nIHBhZ2VcclxuXHQkKCdhW2hyZWZePVwiI1wiXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHR2YXIgdGFyZ2V0ID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XHJcblx0XHRpZiAoIHRhcmdldC5sZW5ndGggPiAxICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PSAnLycgJiYgd2luZG93LmxvY2F0aW9uLnNlYXJjaCA9PSAnJykgeyAvL2lmIGhvbWUgcGFnZSBhbmQgbm8gc2VhcmNoIHF1ZXJ5IGFuZCBubyBvbmx5ICNcclxuXHRcdFx0Ly9pZiAoJCh0YXJnZXQpLmhhc0NsYXNzKCdhbmltYXRlJykpICQodGFyZ2V0KS5yZW1vdmVDbGFzcygnYW5pbWF0ZScpO1xyXG5cdFx0XHRpZiAoYnVyZ2VyLmlzKCc6dmlzaWJsZScpKSBidXJnZXIuY2xpY2soKTsgLy9jbG9zZSBidXJnZXIgbWVudSBvbiBsaW5rIGNsaWNraW5nXHJcblxyXG5cdFx0XHR2YXIgdG9wID0gJCh0YXJnZXQpLm9mZnNldCgpLnRvcDtcclxuXHRcdFx0JCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogdG9wfSwgNTAwK3RvcC80KTsgLy84MDAgLSDQtNC70LjRgtC10LvRjNC90L7RgdGC0Ywg0YHQutGA0L7Qu9C70LjQvdCz0LAg0LIg0LzRgVx0XHRcdFxyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Ly90YXJnZXQgPSB0YXJnZXQucmVwbGFjZSgvW15BLVphLXpdL2csIFwiXCIpO1xyXG5cdFx0XHRsb2NhdGlvbi5yZXBsYWNlKCcvJyt0YXJnZXQpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuKi9cclxuLypcclxuXHRidXJnZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdGlmIChidXJnZXIuaXMoJzp2aXNpYmxlJykpIHtcclxuXHRcdFx0YnVyZ2VyLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcclxuXHRcdFx0JCgnI21lbnUtdG9wJykudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHQkKGRvY3VtZW50LmJvZHkpLnRvZ2dsZUNsYXNzKCdtb2RhbCcpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG4qL1xyXG5cdC8vTmV3IHZlcnNpb24gd2l0aCBvd24gY2xvc2UgYnV0dG9uIGluIG1lbnVcclxuXHRidXJnZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdGlmICghbW9iaWxlTWVudS5oYXNDbGFzcygnYWN0aXZlJykpIHtcclxuXHRcdFx0bW9iaWxlTWVudS5wcmVwZW5kKCc8ZGl2IGNsYXNzPVwiY2xvc2UtaWNvblwiPjwvZGl2PicpO1xyXG5cdFx0XHQvL2J1cmdlci50b2dnbGVDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdG1vYmlsZU1lbnUuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHQvLyQoZG9jdW1lbnQuYm9keSkudG9nZ2xlQ2xhc3MoJ21vZGFsJyk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdG1vYmlsZU1lbnUub24oJ2NsaWNrJywnLmNsb3NlLWljb24nLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0bW9iaWxlTWVudS5yZW1vdmVDbGFzcygnYWN0aXZlJykuY2hpbGRyZW4oKS5yZW1vdmUoJy5jbG9zZS1pY29uJyk7XHJcblx0fSk7XHJcblx0XHJcblx0dmFyIHN1Ym1lbnVfaXRlbSA9ICQoJy5tZW51LWl0ZW0taGFzLWNoaWxkcmVuIGEnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0JCh0aGlzKS5wYXJlbnQoKS50b2dnbGVDbGFzcygnY29sbGFwc2VkJyk7XHJcblx0fSk7XHJcblx0XHRcclxuXHQkKCBkb2N1bWVudCApLm9uKCAna2V5dXAnLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0aWYoIGUua2V5Q29kZSA9PSAyNyAmJiAhc2VhcmNoLmhhc0NsYXNzKCdoaWRkZW4nKSApXHJcblx0XHRcdC8vY2xvc2Ugc2VhcmNoIGZvcm1cclxuXHRcdFx0c2VhcmNoLmFkZENsYXNzKCdoaWRkZW4nKSAvL2lmKCBlLmtleUNvZGUgPT0gMjcgJiYgc2VhcmNoLmlzKCc6dmlzaWJsZScpICkgc2VhcmNoLmZhZGVUb2dnbGUoMzAwKVxyXG5cdFx0ZWxzZVxyXG5cdFx0aWYoIGUua2V5Q29kZSA9PSAyNyAmJiAhb3ZlcmxheS5oYXNDbGFzcygnaGlkZGVuJykgKVxyXG5cdFx0XHRvdmVybGF5LmNsaWNrKCkgLy9jbG9zZSBvdmVybGF5IGZvcm1cclxuXHRcdGVsc2UgLy9jbG9zZSBidXJnZXIgbWVudSBvbiBlc2Mga2V5XHJcblx0XHRpZiggZS5rZXlDb2RlID09IDI3ICYmIG1vYmlsZU1lbnUuaGFzQ2xhc3MoJ2FjdGl2ZScpICkgbW9iaWxlTWVudS5jaGlsZHJlbignLmNsb3NlLWljb24nKS5jbGljaygpOyAvLyBpZiggZS5rZXlDb2RlID09IDI3ICYmIGJ1cmdlci5oYXNDbGFzcygnYWN0aXZlJykgKSBidXJnZXIuY2xpY2soKTtcclxuXHR9KTtcclxuXHJcblxyXG5cdHNjcm9sbHVwLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHR2YXIgbWMgPSBkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLWNvbnRhaW5lcicpO1xyXG5cdFx0c2Nyb2xsdXBcclxuXHRcdC5mYWRlT3V0KCdzbG93JylcclxuXHRcdC5kZWxheSg1MDApXHJcblx0XHQucmVtb3ZlKClcclxuXHRcdC5kZWxheSg1MDApXHJcblx0XHQucXVldWUoIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRtYy5zY3JvbGxJbnRvVmlldyh7YmxvY2s6IFwic3RhcnRcIiwgYmVoYXZpb3I6IFwic21vb3RoXCJ9KTtcclxuXHRcdH0pO1xyXG5cdH0pO1xyXG5cclxuXHRiYWNrMnRvcC5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0Ly8gODAwIC0g0YHQutC+0YDQvtGB0YLRjCDQt9Cw0LTQtdGA0LbQutC4INC/0LXRgNC10LzQtdGJ0LXQvdC40Y8g0L3QsNCy0LXRgNGFICjQsiDQvNC40LvQu9C40YHQtdC60YPQvdC00LDRhSlcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdCQoJ2h0bWwsYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogMH0sIDgwMCk7XHJcblx0fSk7XHJcblxyXG5cdCQoJyNuYXYtc2VhcmNoJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdGlmICggIXNlYXJjaC5hdHRyKCdkaXNwbGF5Jywnbm9uZScpICYmIHNlYXJjaC5maW5kKCcjcycpLnZhbCgpICkge1xyXG5cdFx0XHQkKCcjc2VhcmNoZm9ybScpLnN1Ym1pdCgpOyBcclxuXHRcdH0gZWxzZSBzZWFyY2guZmFkZVRvZ2dsZSgzMDApO1xyXG5cdH0pO1xyXG4vKlxyXG5cdCQoJyNuYXYtc2VhcmNoJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdHNlYXJjaC50b2dnbGVDbGFzcygnaGlkZGVuJyk7XHJcblx0fSk7XHJcblxyXG5cdCQoJyNzZWFyY2hmb3JtJykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHQvL9C40LTQtdGCINC/0L7QuNGB0LouLi5cclxuXHRcdC8v0LzQvtC20L3QviDQstGL0LLQtdGB0YLQuCBwcmVsb2FkZXIg0YEg0L3QsNC00L/QuNGB0YzRjlxyXG5cdH0pO1xyXG5cdCQoJyNzZWFyY2hmb3JtLWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuXHRcdHZhciBmaWVsZF9zID0gc2VhcmNoLmZpbmQoJyNzJyk7XHJcblx0XHRpZiAoIGZpZWxkX3MudmFsKCkgKSBmaWVsZF9zLnZhbCgnJylcclxuXHRcdGVsc2Ugc2VhcmNoLmZhZGVUb2dnbGUoMzAwKTtcclxuXHR9KTtcclxuKi9cclxuXHRzZWFyY2gub24oJ2NsaWNrJywnLmNsb3NlLWljb24nLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0c2VhcmNoLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuXHR9KTtcclxuXHJcblx0b3ZlcmxheS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG5cdFx0JCh0aGlzKS5hZGRDbGFzcygnaGlkZGVuJyk7XHJcblx0XHRlbmFibGVTY3JvbGwoKTtcclxuXHR9KTtcclxuXHJcblx0aWYgKCAkKCcuamNhcm91c2VsJykuaGFzKCdsaS5zbGlkZScpLmxlbmd0aCApIHtcclxuXHJcblx0XHQkKCdbZGF0YS1qY2Fyb3VzZWxdJykuZWFjaChmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIGVsID0gJCh0aGlzKTtcclxuXHRcdFx0ZWwuamNhcm91c2VsKGVsLmRhdGEoKSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHR2YXIgeFN0YXJ0LCB5U3RhcnQ7XHJcblx0XHR2YXIgc3RvcFRvdWNoO1xyXG5cdFx0dmFyIHNsaWRlc1BlclBhZ2UgPSAxO1xyXG5cclxuXHRcdHZhciBjYXJvdXNlbCA9ICQoJy5qY2Fyb3VzZWwnKTtcclxuXHRcdGNhcm91c2VsXHJcblx0XHRcdC5vbignamNhcm91c2VsOmNyZWF0ZSBqY2Fyb3VzZWw6cmVsb2FkJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0dmFyIGNhcm91c2VsX3cgPSBjYXJvdXNlbC5wYXJlbnQoKS5pbm5lcldpZHRoKCksXHJcblx0XHRcdFx0XHRjYXJvdXNlbF9oID0gY2Fyb3VzZWwucGFyZW50KCkuaW5uZXJIZWlnaHQoKTtcclxuXHJcblx0XHRcdFx0c2xpZGVzUGVyUGFnZSA9IChjYXJvdXNlbF93ID4gY2Fyb3VzZWxfaCkgPyBNYXRoLnRydW5jKCAgY2Fyb3VzZWxfdyAvIGNhcm91c2VsX2ggKSA6IDE7XHJcblxyXG5cdFx0XHRcdHZhciBzbGlkZV93aWR0aCA9IE1hdGguY2VpbCggY2Fyb3VzZWxfdyAvIHNsaWRlc1BlclBhZ2UgKTtcclxuXHRcdFx0XHRjYXJvdXNlbC5qY2Fyb3VzZWwoJ2l0ZW1zJykuY3NzKFwid2lkdGhcIiwgc2xpZGVfd2lkdGggKyAncHgnKTtcclxuXHRcdFx0fSlcclxuXHRcdFx0Lm9uKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdHhTdGFydCA9IGUudG91Y2hlc1swXS5zY3JlZW5YO1xyXG5cdFx0XHRcdHlTdGFydCA9IGUudG91Y2hlc1swXS5zY3JlZW5ZO1xyXG5cdFx0XHRcdHN0b3BUb3VjaCA9IG51bGw7XHJcblx0XHRcdH0pXHJcblx0XHRcdC5vbigndG91Y2htb3ZlJywgZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdHZhciB4TW92ZW1lbnQgPSBNYXRoLmFicyhlLnRvdWNoZXNbMF0uc2NyZWVuWCAtIHhTdGFydCk7XHJcblx0XHRcdFx0dmFyIHlNb3ZlbWVudCA9IE1hdGguYWJzKGUudG91Y2hlc1swXS5zY3JlZW5ZIC0geVN0YXJ0KTtcclxuXHRcdFx0XHRpZiAoc3RvcFRvdWNoID09IG51bGwgJiYgKHhNb3ZlbWVudCA+IDEwIHx8IHlNb3ZlbWVudCA+IDEwKSlcclxuXHRcdFx0XHRcdHN0b3BUb3VjaCA9ICh5TW92ZW1lbnQgPCB4TW92ZW1lbnQpID8gZGlzYWJsZVRvdWNoTW92ZSgpIDogZW5hYmxlVG91Y2hNb3ZlKCk7XHJcblx0XHRcdH0pXHJcblx0XHRcdC5vbigndG91Y2hlbmQgdG91Y2hjYW5jZWwnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRzdG9wVG91Y2ggJiYgZW5hYmxlVG91Y2hNb3ZlKCk7XHJcblx0XHRcdH0pXHJcblx0XHRcdC5vbignamNhcm91c2VsOmNyZWF0ZWVuZCBqY2Fyb3VzZWw6YW5pbWF0ZWVuZCcsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdCQodGhpcykuamNhcm91c2VsKCd0YXJnZXQnKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdH0pXHJcblx0XHRcdC5vbignamNhcm91c2VsOnZpc2libGVvdXQnLCAnbGknLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHQkKHRoaXMpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuXHRcdFx0fSlcclxuXHRcdFx0Lm9uKCdjbGljaycsICdsaScsIGZ1bmN0aW9uIChlKSB7XHJcblx0XHRcdFx0dmFyIHNyYyA9ICQodGhpcykuYXR0cignc3JjLXVybCcpO1xyXG5cdFx0XHRcdGlmIChzcmMpIHtcclxuXHRcdFx0XHRcdHNyYyA9ICd1cmwoJytzcmMrJyknO1xyXG5cdFx0XHRcdFx0Ly92YXIgYmcgPSAkKGUudGFyZ2V0KS5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnKTtcclxuXHRcdFx0XHRcdC8vYmcgPSBiZy5yZXBsYWNlKCd1cmwoJywnJykucmVwbGFjZSgnKScsJycpLnJlcGxhY2UoL1xcXCIvZ2ksIFwiXCIpO1xyXG5cdFx0XHRcdFx0IW92ZXJsYXkuY2hpbGRyZW4oJy5pbWFnZWJveCcpLmxlbmd0aCAmJiBvdmVybGF5LmFwcGVuZCgnPGRpdiBjbGFzcz1cImltYWdlYm94XCI+PC9kaXY+PGRpdiBjbGFzcz1cImNsb3NlIGNsb3NlLWljb25cIiB0aXRsZT1cIkNsb3NlXCI+PC9kaXY+Jyk7XHJcblx0XHRcdFx0XHRvdmVybGF5LmNoaWxkcmVuKCcuaW1hZ2Vib3gnKS5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnLCBzcmMpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHRcdFx0XHRcdGRpc2FibGVTY3JvbGwoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pXHJcblx0XHRcdC5qY2Fyb3VzZWwoe1xyXG5cdFx0XHRcdC8vc2Nyb2xsOiBzbGlkZXNQZXJQYWdlLFxyXG5cdFx0XHRcdC8vY2VudGVyOiB0cnVlLFxyXG5cdFx0XHRcdHdyYXA6ICdjaXJjdWxhcicsXHJcblx0XHRcdFx0YW5pbWF0aW9uOiA1MDAsXHJcblx0XHRcdFx0Ly90cmFuc2l0aW9uczogdHJ1ZSxcclxuXHRcdFx0XHR0cmFuc2l0aW9uczogTW9kZXJuaXpyLmNzc3RyYW5zaXRpb25zID8ge1xyXG5cdFx0XHRcdFx0dHJhbnNmb3JtczogICBNb2Rlcm5penIuY3NzdHJhbnNmb3JtcyxcclxuXHRcdFx0XHRcdHRyYW5zZm9ybXMzZDogTW9kZXJuaXpyLmNzc3RyYW5zZm9ybXMzZCxcclxuXHRcdFx0XHRcdGVhc2luZzogICAgICAgJ2Vhc2UnXHJcblx0XHRcdFx0fSA6IGZhbHNlXHJcblx0XHRcdH0pXHJcblx0XHRcdC8vLmpjYXJvdXNlbCgnc2Nyb2xsJywgJys9JytTdHJpbmcoc2xpZGVzUGVyUGFnZSkpXHJcblx0XHRcdC5qY2Fyb3VzZWxTd2lwZSh7XHJcblx0XHRcdFx0Ly9wZXJTd2lwZTogc2xpZGVzUGVyUGFnZVxyXG5cdFx0XHRcdC8vbWV0aG9kOiAnc2Nyb2xsSW50b1ZpZXcnIC8vIGJ5IGRlZmF1bHQgJ3Njcm9sbCdcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRpZiAoICd0cnVlJyA9PT0gY2Fyb3VzZWwuYXR0cignZGF0YS1qY2Fyb3VzZWxhdXRvc2Nyb2xsJykgKSB7XHJcblx0XHRcdFx0Y2Fyb3VzZWwuamNhcm91c2VsQXV0b3Njcm9sbCh7XHJcblx0XHRcdFx0XHRpbnRlcnZhbDogIDUwMDAsXHJcblx0XHRcdFx0XHQvL2F1dG9zdGFydDogZmFsc2UsXHJcblx0XHRcdFx0XHQvL3RhcmdldDogJy09MScrU3RyaW5nKHNsaWRlc1BlclBhZ2UpXHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICggJCgnLmpjYXJvdXNlbC13cmFwcGVyJykuaGFzKCcuamNhcm91c2VsLWNvbnRyb2wnKS5sZW5ndGggKSB7XHJcblxyXG5cdFx0XHRcdCQoJy5qY2Fyb3VzZWwtY29udHJvbC5wcmV2JylcclxuXHRcdFx0XHRcdC5vbignamNhcm91c2VsY29udHJvbDphY3RpdmUnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnaW5hY3RpdmUnKTtcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0XHQub24oJ2pjYXJvdXNlbGNvbnRyb2w6aW5hY3RpdmUnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0JCh0aGlzKS5hZGRDbGFzcygnaW5hY3RpdmUnKTtcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0XHQuamNhcm91c2VsQ29udHJvbCh7XHJcblx0XHRcdFx0XHRcdC8vdGFyZ2V0OiAnLT0nK1N0cmluZyhzbGlkZXNQZXJQYWdlKVxyXG5cdFx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdCQoJy5qY2Fyb3VzZWwtY29udHJvbC5uZXh0JylcclxuXHRcdFx0XHRcdC5vbignamNhcm91c2VsY29udHJvbDphY3RpdmUnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnaW5hY3RpdmUnKTtcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0XHQub24oJ2pjYXJvdXNlbGNvbnRyb2w6aW5hY3RpdmUnLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0JCh0aGlzKS5hZGRDbGFzcygnaW5hY3RpdmUnKTtcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0XHQuamNhcm91c2VsQ29udHJvbCh7XHJcblx0XHRcdFx0XHRcdC8vdGFyZ2V0OiAnKz0nK1N0cmluZyhzbGlkZXNQZXJQYWdlKVxyXG5cdFx0XHRcdFx0fSk7XHJcblx0LypcclxuXHRcdFx0XHRpZiAoICEkKFwiaHRtbFwiKS5oYXMoXCJtb2JpbGVcIikgKSB7XHJcblx0XHRcdFx0XHQkKFwiLmpjYXJvdXNlbC13cmFwcGVyXCIpLmhvdmVyKCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0JCgnLmpjYXJvdXNlbC1jb250cm9sJykuZmFkZUluKDMwMCk7XHJcblx0XHRcdFx0XHR9LCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0JCgnLmpjYXJvdXNlbC1jb250cm9sJykuZmFkZU91dCgzMDApO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cdCovXHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0aWYgKCAkKCcuamNhcm91c2VsLXdyYXBwZXInKS5oYXMoJy5qY2Fyb3VzZWwtcGFnaW5hdGlvbicpLmxlbmd0aCAmJiAndHJ1ZScgPT09ICQoJy5qY2Fyb3VzZWwtcGFnaW5hdGlvbicpLmF0dHIoJ2RhdGEtamNhcm91c2VscGFnaW5hdGlvbicpICkge1xyXG5cdFx0XHQkKCcuamNhcm91c2VsLXBhZ2luYXRpb24nKVxyXG5cdFx0XHRcdC5vbignamNhcm91c2VscGFnaW5hdGlvbjphY3RpdmUnLCAnYScsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0JCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdFx0fSlcclxuXHRcdFx0XHQub24oJ2pjYXJvdXNlbHBhZ2luYXRpb246aW5hY3RpdmUnLCAnYScsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdFx0fSlcclxuXHRcdFx0XHQuamNhcm91c2VsUGFnaW5hdGlvbih7XHJcblx0XHRcdFx0XHQvLydwZXJQYWdlJzogc2xpZGVzUGVyUGFnZVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0fSBlbHNlICQoJy5qY2Fyb3VzZWwtcGFnaW5hdGlvbicpLnJlbW92ZSgpO1xyXG5cclxuXHR9XHJcblxyXG5cdC8vQWRkaW5nIGFuIGFnZW50IHRvIEhUTUwgc2VsZWN0b3JcclxuXHR2YXIgZGV2aWNlQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7XHJcblx0aWYgKGRldmljZUFnZW50Lm1hdGNoKC8oaXBob25lfGlwb2R8aXBhZCkvKSkge1xyXG5cdFx0JChcImh0bWxcIikuYWRkQ2xhc3MoXCJtb2JpbGVcIik7XHJcblx0XHQkKFwiaHRtbFwiKS5hZGRDbGFzcyhcImlvc1wiKTtcclxuXHR9XHJcblx0aWYgKG5hdmlnYXRvci51c2VyQWdlbnQuc2VhcmNoKFwiTVNJRVwiKSA+PSAwKSB7XHJcblx0XHQkKFwiaHRtbFwiKS5hZGRDbGFzcyhcImllXCIpO1xyXG5cdH1cclxuXHRlbHNlIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LnNlYXJjaChcIkNocm9tZVwiKSA+PSAwKSB7XHJcblx0XHQkKFwiaHRtbFwiKS5hZGRDbGFzcyhcImNocm9tZVwiKTtcclxuXHR9XHJcblx0ZWxzZSBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5zZWFyY2goXCJGaXJlZm94XCIpID49IDApIHtcclxuXHRcdCQoXCJodG1sXCIpLmFkZENsYXNzKFwiZmlyZWZveFwiKTtcclxuXHR9XHJcblx0ZWxzZSBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5zZWFyY2goXCJTYWZhcmlcIikgPj0gMCAmJiBuYXZpZ2F0b3IudXNlckFnZW50LnNlYXJjaChcIkNocm9tZVwiKSA8IDApIHtcclxuXHRcdCQoXCJodG1sXCIpLmFkZENsYXNzKFwic2FmYXJpXCIpO1xyXG5cdH1cclxuXHRlbHNlIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LnNlYXJjaChcIk9wZXJhXCIpID49IDApIHtcclxuXHRcdCQoXCJodG1sXCIpLmFkZENsYXNzKFwib3BlcmFcIik7XHJcblx0fVxyXG5cclxufSk7XHJcbiJdfQ==
